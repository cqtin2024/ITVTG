<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫≠p nh·∫≠t D·ªØ li·ªáu Gi·∫£i ƒë·∫•u Pickleball ITVTG 2025</title>
    <!-- Th∆∞ vi·ªán Vue.js 3 - D√πng CDN ƒë·ªÉ ƒë∆°n gi·∫£n -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* S·ª≠ d·ª•ng Tailwind-like classes ƒë·ªÉ l√†m cho giao di·ªán hi·ªán ƒë·∫°i h∆°n */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --text-color: #333;
            --bg-light: #f4f4f9;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-light); color: var(--text-color); margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: var(--primary-color); border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 20px; font-weight: 700; }
        .tournament-info div { margin-bottom: 8px; font-size: 0.95rem; }

        /* B·∫£ng x·∫øp h·∫°ng v√† Tr·∫≠n ƒë·∫•u */
        .standings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .standings-card { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .standings-card h3 { margin: 0; padding: 12px; background-color: var(--secondary-color); color: white; border-bottom: none; }

        .standings-table, .matches-table { width: 100%; border-collapse: collapse; }
        .standings-table th, .standings-table td { padding: 8px 10px; text-align: left; font-size: 0.9rem; }
        .matches-table th, .matches-table td { border: 1px solid #ddd; padding: 10px 12px; text-align: left; font-size: 0.9rem; }
        
        .standings-table th { background-color: #34495e; color: white; }
        .standings-table tr:nth-child(even) { background-color: #f9f9f9; }
        .standings-table tr:hover { background-color: #f1f1f1; }
        .rank-cell { font-weight: bold; width: 40px; text-align: center; }

        /* B·∫£ng Tr·∫≠n ƒë·∫•u */
        .matches-table th { background-color: var(--primary-color); color: white; }
        .matches-table tr:nth-child(even) { background-color: #f9f9f9; }
        .matches-table tr:hover { background-color: #f1f1f1; }
        .match-group-header { background-color: #2c3e50 !important; color: white; text-align: center !important; font-weight: bold; }
        
        input[type="number"] { width: 50px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        .update-button { 
            background-color: var(--danger-color); color: white; border: none; padding: 6px 12px; 
            font-size: 0.85rem; cursor: pointer; border-radius: 6px; transition: all 0.3s; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .update-button:hover { background-color: #c0392b; transform: translateY(-1px); }
        .winner-cell { font-weight: bold; color: var(--secondary-color); }
        .loser-cell { color: var(--danger-color); opacity: 0.7; }

        /* Error/Message Box Styling (Thay th·∫ø alert()) */
        .message-box {
            position: fixed; top: 20px; right: 20px;
            background-color: #f8d7da; color: #721c24;
            border: 1px solid #f5c6cb; border-radius: 8px;
            padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 400px; z-index: 1000;
            opacity: 0; transition: opacity 0.5s, transform 0.5s;
            transform: translateY(-20px);
        }
        .message-box.show {
            opacity: 1;
            transform: translateY(0);
        }
        .message-box button {
            float: right; background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #721c24;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .matches-table th, .matches-table td { padding: 8px; font-size: 0.8rem; }
            .standings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div id="app" class="container">
    <div v-if="errorMessage" class="message-box" :class="{ 'show': isErrorVisible }">
        <button @click="hideErrorMessage">&times;</button>
        <strong>Th√¥ng B√°o:</strong>
        <p v-html="errorMessage"></p>
    </div>

    <h1>{{ tournament.TN }}</h1>
    <p>Gi·∫£i ƒë·∫•u do **{{ tournament.Org }}** t·ªï ch·ª©c. H√£y c·∫≠p nh·∫≠t ƒëi·ªÉm s·ªë ƒë·ªÉ xem b·∫£ng x·∫øp h·∫°ng thay ƒë·ªïi!</p>

    <div class="tournament-info">
        <h2>Th√¥ng Tin Chung</h2>
        <div>**Th·ªùi gian:** {{ tournament.SD }} - {{ tournament.ED }} | B·∫Øt ƒë·∫ßu l√∫c {{ tournament.FTT }}</div>
        <div>**ƒê·ªãa ƒëi·ªÉm thi ƒë·∫•u:** {{ tournament.VL }} (<a :href="tournament.MapVL" target="_blank">Xem b·∫£n ƒë·ªì</a>)</div>
        <div>**Gala Dinner:** {{ tournament.GL }} | L√∫c {{ tournament.GT }} (<a :href="tournament.MapGL" target="_blank">Xem b·∫£n ƒë·ªì</a>)</div>
        <p style="font-weight: bold; color: var(--secondary-color); margin-top: 10px;">
            D·ªØ li·ªáu tr·∫≠n ƒë·∫•u ƒëang ƒë∆∞·ª£c l∆∞u tr·ªØ c·ª•c b·ªô (Local Storage). T·ª± ƒë·ªông l∆∞u m·ªói 15 gi√¢y.
        </p>
    </div>

    <hr>

    <h2>üèÜ B·∫£ng X·∫øp H·∫°ng V√≤ng B·∫£ng</h2>
    <div class="standings-grid">
        <div class="standings-card" v-for="(group, groupName) in groupedStandings" :key="groupName">
            <h3>B·∫£ng {{ groupName }}</h3>
            <table class="standings-table">
                <thead>
                    <tr>
                        <th class="rank-cell">#</th>
                        <th>ƒê·ªôi (T√™n r√∫t g·ªçn)</th>
                        <th>W</th>
                        <th>L</th>
                        <th>Pts</th>
                        <th>+/-</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(team, index) in group" :key="team.T">
                        <td class="rank-cell">{{ index + 1 }}</td>
                        <td>{{ team.Tn }}</td>
                        <td>{{ team.W }}</td>
                        <td>{{ team.L }}</td>
                        <td>{{ team.Pts }}</td>
                        <td>{{ team.gD }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <hr>

    <h2>T·∫•t C·∫£ C√°c Tr·∫≠n ƒê·∫•u</h2>
    <table class="matches-table">
        <thead>
            <tr>
                <th>M√£ Tr·∫≠n</th>
                <th>Th·ªùi gian</th>
                <th>S√¢n</th>
                <th>ƒê·ªôi A</th>
                <th>T·ª∑ s·ªë A</th>
                <th>ƒê·ªôi B</th>
                <th>T·ª∑ s·ªë B</th>
                <th>ƒê·ªôi Th·∫Øng</th>
                <th>C·∫≠p nh·∫≠t</th>
            </tr>
        </thead>
        <tbody>
            <template v-for="(match, index) in matches" :key="index">
                <!-- Ph√¢n bi·ªát v√≤ng b·∫£ng v√† lo·∫°i tr·ª±c ti·∫øp b·∫±ng header group -->
                <tr v-if="index === 0 || match.Mc.substring(0, 2) !== matches[index-1].Mc.substring(0, 2)">
                    <td colspan="9" class="match-group-header">
                        {{ getMatchGroupName(match.Mc) }}
                    </td>
                </tr>

                <tr>
                    <td>{{ match.Mc }}</td>
                    <td>{{ match.t }}</td>
                    <td>{{ match.c }}</td>
                    <td :class="{'winner-cell': match.Wn === match.A, 'loser-cell': match.Wn === match.B}">{{ match.A }}</td>
                    <td>
                        <!-- R√†ng bu·ªôc nh·∫≠p li·ªáu: min="0", max s·∫Ω do JS x·ª≠ l√Ω -->
                        <input type="number" v-model.number="match.sA" min="0" :max="match.Mc.startsWith('G') || match.Mc.startsWith('QF') ? 11 : 15" />
                    </td>
                    <td :class="{'winner-cell': match.Wn === match.B, 'loser-cell': match.Wn === match.A}">{{ match.B }}</td>
                    <td>
                        <!-- R√†ng bu·ªôc nh·∫≠p li·ªáu: min="0", max s·∫Ω do JS x·ª≠ l√Ω -->
                        <input type="number" v-model.number="match.sB" min="0" :max="match.Mc.startsWith('G') || match.Mc.startsWith('QF') ? 11 : 15" />
                    </td>
                    <td :class="{'winner-cell': match.Wn !== ''}">
                        {{ match.Wn === '' ? 'ƒêang ƒë·∫•u...' : match.Wn }}
                    </td>
                    <td>
                        <!-- Cho ph√©p c·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c v√≤ng -->
                        <button 
                            class="update-button" 
                            @click="updateMatch(match)"
                        >
                            L∆∞u
                        </button>
                    </td>
                </tr>
            </template>
        </tbody>
    </table>
    
    <p style="margin-top: 30px; font-size: 0.85rem; color: #7f8c8d;">
        *L∆∞u √Ω v·ªÅ r√†ng bu·ªôc ƒëi·ªÉm s·ªë:
        <br>- **V√≤ng B·∫£ng & T·ª© K·∫øt (GAx, QFx):** ƒê·ªôi th·∫Øng ph·∫£i ghi 11 ƒëi·ªÉm, ƒë·ªôi thua t·ªëi ƒëa 10 ƒëi·ªÉm (11-x, x&le;10).
        <br>- **B√°n K·∫øt & Chung K·∫øt (SFx, F):** ƒê·ªôi th·∫Øng ph·∫£i ghi 15 ƒëi·ªÉm, ƒë·ªôi thua t·ªëi ƒëa 14 ƒëi·ªÉm (15-x, x&le;14).
        <br>- H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t B·∫£ng X·∫øp H·∫°ng V√≤ng B·∫£ng sau m·ªói l·∫ßn b·∫°n nh·∫•n n√∫t 'L∆∞u'.
    </p>

</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue

    // D·ªØ li·ªáu JSON ban ƒë·∫ßu
    const tournamentData = {
        "key_legend": { /* ... */ },
        "TournamentInfo": {
            "TN": "Pickleball ITVTG Tournament 2025",
            "Org": "IT V≈©ng T√†u Goup",
            "LogoL": "https://github.com/cqtin2024/ITVTG/blob/main/LogoITGVT01.png",
            "SD": "26-10-2025",
            "ED": "26-10-2025",
            "FTT": "14:00",
            "VL": "HM Sport - Pickleball & Coffee - 195 V√µ Th·ªã S√°u, V≈©ng T√†u",
            "MapVL": "https://maps.app.goo.gl/KqqrpVqmVi4uNg7s7",
            "GL": "Qu√°n nh·∫≠u Th·ªëng Nh·∫•t - 56 Th·ªëng Nh·∫•t, V≈©ng T√†u ",
            "GT": "18:30",
            "MapGL": "https://maps.app.goo.gl/Zbuo59wSeRsHP6E59"
        },
        "teamStandings": [
            { "g": "A", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 4, "T": "Team 9", "Tn": "Duy H∆∞ng-Minh T√∫", "seed": "A1" },
            { "g": "A", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 1, "T": "Team 3", "Tn": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "seed": "A2" },
            { "g": "A", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 3, "T": "Team 11", "Tn": "Minh Chang-Minh Ch√¢u", "seed": "A3" },
            { "g": "A", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 2, "T": "Team 5", "Tn": "Qu·ªëc Kh√°nh-Linh V≈©", "seed": "A4" },
            { "g": "B", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 4, "T": "Team 4", "Tn": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "seed": "B1" },
            { "g": "B", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 1, "T": "Team 7", "Tn": "Qu·ªëc H√πng-ƒê·ª©c Duy", "seed": "B2" },
            { "g": "B", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 3, "T": "Team 12", "Tn": "Thanh S∆°n-Khoa Ti·∫øn", "seed": "B3" },
            { "g": "B", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 2, "T": "Team 1", "Tn": "Quang Ti·∫øn-T·∫•t Th√†nh", "seed": "B4" },
            { "g": "C", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 4, "T": "Team 16", "Tn": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "seed": "C1" },
            { "g": "C", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 1, "T": "Team 10", "Tn": "L√™ Duy-Thanh V∆∞∆°ng", "seed": "C2" },
            { "g": "C", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 3, "T": "Team 14", "Tn": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "seed": "C3" },
            { "g": "C", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 2, "T": "Team 6", "Tn": "ƒê√¥ng Chu-Ng·ªçc H√πng", "seed": "C4" },
            { "g": "D", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 4, "T": "Team 13", "Tn": "B√° Ch√¢u-Hi·ªÅn Phong", "seed": "D1" },
            { "g": "D", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 1, "T": "Team 8", "Tn": "Ti·∫øn M·∫°nh-Quang T√≠n", "seed": "D2" },
            { "g": "D", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 3, "T": "Team 15", "Tn": "Minh Thi·ªán-Duy Minh", "seed": "D3" },
            { "g": "D", "W": 0, "L": 0, "HS": "11", "Pts": 0, "mP": 0, "gR": 2, "T": "Team 2", "Tn": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "seed": "D4" }
        ],
        "matches": [
            { "Mc": "GA1", "t": "14:15", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": 0, "B": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sB": 0, "Wn": "" },
            { "Mc": "GA2", "t": "14:15", "c": "S4", "A": "Minh Chang-Minh Ch√¢u", "sA": 0, "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": 0, "Wn": "" },
            { "Mc": "GA3", "t": "14:45", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": 0, "B": "Minh Chang-Minh Ch√¢u", "sB": 0, "Wn": "" },
            { "Mc": "GA4", "t": "14:45", "c": "S4", "A": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sA": 0, "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": 0, "Wn": "" },
            { "Mc": "GA5", "t": "15:15", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": 0, "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": 0, "Wn": "" },
            { "Mc": "GA6", "t": "15:15", "c": "S4", "A": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sA": 0, "B": "Minh Chang-Minh Ch√¢u", "sB": 0, "Wn": "" },
            { "Mc": "GB1", "t": "14:30", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": 0, "B": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sB": 0, "Wn": "" },
            { "Mc": "GB2", "t": "14:30", "c": "S4", "A": "Thanh S∆°n-Khoa Ti·∫øn", "sA": 0, "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": 0, "Wn": "" },
            { "Mc": "GB3", "t": "15:00", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": 0, "B": "Thanh S∆°n-Khoa Ti·∫øn", "sB": 0, "Wn": "" },
            { "Mc": "GB4", "t": "15:00", "c": "S4", "A": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sA": 0, "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": 0, "Wn": "" },
            { "Mc": "GB5", "t": "15:30", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": 0, "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": 0, "Wn": "" },
            { "Mc": "GB6", "t": "15:30", "c": "S4", "A": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sA": 0, "B": "Thanh S∆°n-Khoa Ti·∫øn", "sB": 0, "Wn": "" },
            { "Mc": "GC1", "t": "14:15", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": 0, "B": "L√™ Duy-Thanh V∆∞∆°ng", "sB": 0, "Wn": "" },
            { "Mc": "GC2", "t": "14:15", "c": "S6", "A": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sA": 0, "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": 0, "Wn": "" },
            { "Mc": "GC3", "t": "14:45", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": 0, "B": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sB": 0, "Wn": "" },
            { "Mc": "GC4", "t": "14:45", "c": "S6", "A": "L√™ Duy-Thanh V∆∞∆°ng", "sA": 0, "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": 0, "Wn": "" },
            { "Mc": "GC5", "t": "15:15", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": 0, "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": 0, "Wn": "" },
            { "Mc": "GC6", "t": "15:15", "c": "S6", "A": "L√™ Duy-Thanh V∆∞∆°ng", "sA": 0, "B": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sB": 0, "Wn": "" },
            { "Mc": "GD1", "t": "14:30", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": 0, "B": "Ti·∫øn M·∫°nh-Quang T√≠n", "sB": 0, "Wn": "" },
            { "Mc": "GD2", "t": "14:30", "c": "S6", "A": "Minh Thi·ªán-Duy Minh", "sA": 0, "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": 0, "Wn": "" },
            { "Mc": "GD3", "t": "15:00", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": 0, "B": "Minh Thi·ªán-Duy Minh", "sB": 0, "Wn": "" },
            { "Mc": "GD4", "t": "15:00", "c": "S6", "A": "Ti·∫øn M·∫°nh-Quang T√≠n", "sA": 0, "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": 0, "Wn": "" },
            { "Mc": "GD5", "t": "15:30", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": 0, "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": 0, "Wn": "" },
            { "Mc": "GD6", "t": "15:30", "c": "S6", "A": "Ti·∫øn M·∫°nh-Quang T√≠n", "sA": 0, "B": "Minh Thi·ªán-Duy Minh", "sB": 0, "Wn": "" },
            // V√≤ng Lo·∫°i Tr·ª±c Ti·∫øp (ƒë√£ ƒë∆∞·ª£c l√†m cho ph√©p nh·∫≠p li·ªáu)
            { "Mc": "QF1", "t": "15:45", "c": "S3", "A": "W.A", "sA": 0, "B": "R.B", "sB": 0, "Wn": "" },
            { "Mc": "QF2", "t": "15:45", "c": "S4", "A": "W.B", "sA": 0, "B": "R.A", "sB": 0, "Wn": "" },
            { "Mc": "QF3", "t": "16:00", "c": "S5", "A": "W.C", "sA": 0, "B": "R.D", "sB": 0, "Wn": "" },
            { "Mc": "QF4", "t": "16:00", "c": "S6", "A": "W.D", "sA": 0, "B": "R.C", "sB": 0, "Wn": "" },
            { "Mc": "SF1", "t": "16:10", "c": "S4", "A": "W.QF1", "sA": 0, "B": "W.QF3", "sB": 0, "Wn": "" },
            { "Mc": "SF2", "t": "16:25", "c": "S5", "A": "W.QF2", "sA": 0, "B": "W.QF4", "sB": 0, "Wn": "" },
            { "Mc": "F", "t": "17:05", "c": "S5", "A": "W.SF1", "sA": 0, "B": "W.SF2", "sB": 0, "Wn": "", "rU": "L.SF1/L.SF2" }
        ],
        "tL": [ /* ... */ ]
    };

    // H√†m ti·ªán √≠ch ƒë·ªÉ hi·ªÉn th·ªã l·ªói (thay th·∫ø alert)
    let errorTimeout;
    const showErrorMessage = (message) => {
        // H√†m n√†y ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p (ƒë∆∞·ª£c l·∫•y trong setupState)
        const appElement = document.getElementById('app');
        if (!appElement || !appElement.__vue_app__) return;
        
        const app = appElement.__vue_app__.component.setupState;
        
        clearTimeout(errorTimeout);
        
        // C·∫≠p nh·∫≠t n·ªôi dung v√† hi·ªÉn th·ªã
        app.errorMessage.value = message;
        app.isErrorVisible.value = true;
        
        // T·ª± ƒë·ªông ·∫©n sau 15 gi√¢y (cho ph√©p ƒë·ªçc th√¥ng b√°o d√†i)
        errorTimeout = setTimeout(() => {
            app.isErrorVisible.value = false;
        }, 15000);
    };


    // H√ÄM QU·∫¢N L√ù D·ªÆ LI·ªÜU C·ª§C B·ªò (LOCAL STORAGE)
    const LOCAL_STORAGE_KEY = 'itvtg_pickleball_matches';

    const loadMatchesFromStorage = () => {
        const storedMatches = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (storedMatches) {
            try {
                const loaded = JSON.parse(storedMatches);
                // ƒê·∫£m b·∫£o scores l√† s·ªë nguy√™n
                loaded.forEach(match => {
                    match.sA = parseInt(match.sA) || 0;
                    match.sB = parseInt(match.sB) || 0;
                });
                console.log('‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu tr·∫≠n ƒë·∫•u t·ª´ Local Storage.');
                return loaded;
            } catch (e) {
                console.error('L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Local Storage:', e);
                return null;
            }
        }
        return null;
    };

    const saveMatchesToStorage = (currentMatches) => {
        try {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentMatches));
            console.log('‚úÖ ƒê√£ l∆∞u d·ªØ li·ªáu tr·∫≠n ƒë·∫•u v√†o Local Storage.');
        } catch (e) {
            console.error('L·ªói khi l∆∞u d·ªØ li·ªáu v√†o Local Storage:', e);
        }
    };
    
    // H√ÄM G·ª¨I D·ªÆ LI·ªÜU REMOTE (C√ì C·∫¢NH B√ÅO V·ªÄ PAT)
    const sendDataToRemoteServer = (data) => {
        const remoteUrl = 'https://github.com/cqtin2024/ITVTG/blob/main/data/statex.json';
        const warningMessage = `
            <div style="color: #721c24; font-weight: bold; background-color: #f8d7da; padding: 5px; border-radius: 4px;">
                C·∫¢NH B√ÅO C·∫¨P NH·∫¨T REMOTE
            </div>
            <p style="margin-top: 10px;">
                D·ªØ li·ªáu ƒë√£ **L∆ØU TH√ÄNH C√îNG V√ÄO LOCAL STORAGE** tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n.
            </p>
            <p>
                Tuy nhi√™n, kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·ª±c ti·∫øp file tr√™n GitHub (${remoteUrl}) b·∫±ng JavaScript frontend. 
                ƒêi·ªÅu n√†y ƒë√≤i h·ªèi ph·∫£i **s·ª≠ d·ª•ng Personal Access Token (PAT)** ƒë·ªÉ x√°c th·ª±c v√† v∆∞·ª£t qua ch√≠nh s√°ch **CORS**.
            </p>
            <p style="color: #e74c3c;">
                **GI·∫¢I PH√ÅP:** B·∫°n c·∫ßn thi·∫øt l·∫≠p m·ªôt **D·ªãch V·ª• Backend Trung Gian** (nh∆∞ Firebase Functions, Netlify Functions, ho·∫∑c m·ªôt API server) ƒë·ªÉ server ƒë√≥ s·ª≠ d·ª•ng PAT v√† ghi d·ªØ li·ªáu l√™n GitHub m·ªôt c√°ch an to√†n.
            </p>
        `;
        
        showErrorMessage(warningMessage);
        console.warn('C·∫¢NH B√ÅO: C·∫≠p nh·∫≠t GitHub th·∫•t b·∫°i. C·∫ßn API trung gian ƒë·ªÉ s·ª≠ d·ª•ng PAT.');
        
        // Logic g·ªçi API server trung gian ƒë·ªÉ ghi d·ªØ li·ªáu s·∫Ω n·∫±m ·ªü ƒë√¢y (n·∫øu c√≥)
    };


    // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
    const initialMatches = loadMatchesFromStorage();
    if (initialMatches) {
         // N·∫øu c√≥ d·ªØ li·ªáu trong local storage, s·ª≠ d·ª•ng n√≥.
         tournamentData.matches = initialMatches;
    } else {
        // N·∫øu kh√¥ng, chu·∫©n b·ªã d·ªØ li·ªáu m·∫∑c ƒë·ªãnh ban ƒë·∫ßu
        tournamentData.matches.forEach(match => {
            match.sA = parseInt(match.sA) || 0;
            match.sB = parseInt(match.sB) || 0;
        });
    }


    // H√†m logic t√≠nh to√°n B·∫£ng X·∫øp H·∫°ng
    const calculateStandings = (matches, initialStandings) => {
        const standingsMap = new Map();
        initialStandings.forEach(team => {
            standingsMap.set(team.Tn, {
                ...team,
                W: 0, 
                L: 0, 
                Pts: 0, 
                mP: 0,
                gS: 0, 
                gA: 0, 
                gD: 0  
            });
        });

        // Ch·ªâ x·ª≠ l√Ω c√°c tr·∫≠n ƒë·∫•u v√≤ng b·∫£ng (GAx, GBx, GCx, GDx)
        matches.forEach(match => {
            if (match.Mc.startsWith('G')) {
                const teamA = standingsMap.get(match.A);
                const teamB = standingsMap.get(match.B);
                
                // B·ªè qua n·∫øu ch∆∞a c√≥ k·∫øt qu·∫£ (0-0)
                if (match.sA === 0 && match.sB === 0) return;

                if (teamA && teamB) {
                    teamA.mP++;
                    teamB.mP++;
                    
                    // C·∫≠p nh·∫≠t ƒëi·ªÉm ghi ƒë∆∞·ª£c/th·ªßng l∆∞·ªõi
                    teamA.gS += match.sA;
                    teamA.gA += match.sB;
                    teamB.gS += match.sB;
                    teamB.gA += match.sA;

                    if (match.sA > match.sB) {
                        // A th·∫Øng
                        teamA.W++;
                        teamB.L++;
                        teamA.Pts += 3; // 3 ƒëi·ªÉm cho ƒë·ªôi th·∫Øng (gi·∫£ ƒë·ªãnh th·ªÉ th·ª©c)
                    } else if (match.sB > match.sA) {
                        // B th·∫Øng
                        teamB.W++;
                        teamA.L++;
                        teamB.Pts += 3; // 3 ƒëi·ªÉm cho ƒë·ªôi th·∫Øng
                    } 
                    // Kh√¥ng c√≥ tr∆∞·ªùng h·ª£p ho√† trong validation m·ªõi
                }
            }
        });

        // T√≠nh to√°n Hi·ªáu s·ªë b√†n th·∫Øng thua
        standingsMap.forEach(team => {
            team.gD = team.gS - team.gA;
        });

        // Gom nh√≥m v√† s·∫Øp x·∫øp
        const grouped = {};
        standingsMap.forEach(team => {
            const groupName = team.g;
            if (!grouped[groupName]) {
                grouped[groupName] = [];
            }
            grouped[groupName].push(team);
        });

        // S·∫Øp x·∫øp t·ª´ng nh√≥m: Pts -> gD -> T√™n ƒë·ªôi (tƒÉng d·∫ßn)
        for (const groupName in grouped) {
            grouped[groupName].sort((a, b) => {
                if (b.Pts !== a.Pts) return b.Pts - a.Pts; // ƒêi·ªÉm s·ªë (gi·∫£m d·∫ßn)
                if (b.gD !== a.gD) return b.gD - a.gD;     // Hi·ªáu s·ªë (gi·∫£m d·∫ßn)
                return a.Tn.localeCompare(b.Tn);          // T√™n ƒë·ªôi (tƒÉng d·∫ßn)
            });
        }
        
        return grouped;
    };


    createApp({
        setup() {
            const tournament = ref(tournamentData.TournamentInfo);
            const matches = ref(tournamentData.matches);
            const standings = ref(tournamentData.teamStandings);
            
            // State cho h·ªôp tho·∫°i l·ªói/th√¥ng b√°o
            const errorMessage = ref('');
            const isErrorVisible = ref(false);
            
            // H√†m ·∫©n th√¥ng b√°o l·ªói
            const hideErrorMessage = () => {
                isErrorVisible.value = false;
                errorMessage.value = '';
            };


            // T·ª± ƒë·ªông l∆∞u v√†o Local Storage m·ªói 15 gi√¢y
            onMounted(() => {
                setInterval(() => {
                    saveMatchesToStorage(matches.value);
                    sendDataToRemoteServer(matches.value); // G·ª≠i c·∫£nh b√°o
                }, 15000); // 15 gi√¢y
            });
            
            // D·ªØ li·ªáu t√≠nh to√°n B·∫£ng X·∫øp H·∫°ng (Computed)
            const groupedStandings = computed(() => {
                // T·ª± ƒë·ªông t√≠nh to√°n l·∫°i m·ªói khi matches.value thay ƒë·ªïi
                return calculateStandings(matches.value, standings.value);
            });
            
            // H√†m l·∫•y t√™n nh√≥m tr·∫≠n ƒë·∫•u
            const getMatchGroupName = (mc) => {
                const prefix = mc.substring(0, 2);
                if (prefix.startsWith('G')) return `V√≤ng B·∫£ng - B·∫£ng ${mc.substring(1, 2)}`;
                switch(prefix) {
                    case 'QF': return 'V√≤ng T·ª© K·∫øt';
                    case 'SF': return 'V√≤ng B√°n K·∫øt';
                    case 'F': return 'Tr·∫≠n Chung K·∫øt';
                    default: return 'Kh√°c';
                }
            };


            // H√ÄM C·∫¨P NH·∫¨T TR·∫¨N ƒê·∫§U (K√àM R√ÄNG BU·ªòC M·ªöI)
            const updateMatch = (match) => {
                // ƒê·∫£m b·∫£o ƒëi·ªÉm s·ªë l√† s·ªë nguy√™n kh√¥ng √¢m
                const scoreA = Math.max(0, parseInt(match.sA) || 0);
                const scoreB = Math.max(0, parseInt(match.sB) || 0);
                
                // 1. X√°c ƒë·ªãnh r√†ng bu·ªôc
                const prefix = match.Mc.substring(0, 2);
                let winScore, loseMax;
                let maxOverall;
                let matchType = '';

                if (prefix.startsWith('G') || prefix === 'QF') {
                    // V√≤ng B·∫£ng & T·ª© K·∫øt (0-11)
                    winScore = 11;
                    loseMax = 10;
                    maxOverall = 11;
                    matchType = 'V√≤ng B·∫£ng/T·ª© K·∫øt';
                } else if (prefix === 'SF' || prefix === 'F') {
                    // B√°n K·∫øt & Chung K·∫øt (0-15)
                    winScore = 15;
                    loseMax = 14;
                    maxOverall = 15;
                    matchType = 'B√°n K·∫øt/Chung K·∫øt';
                } else {
                    // Tr·∫≠n ƒë·∫•u kh√¥ng x√°c ƒë·ªãnh
                    winScore = Infinity; loseMax = Infinity; maxOverall = Infinity;
                    matchType = 'Kh√¥ng x√°c ƒë·ªãnh';
                }
                
                // C·∫≠p nh·∫≠t l·∫°i gi√° tr·ªã input ƒë√£ ƒë∆∞·ª£c ƒë·∫£m b·∫£o l√† s·ªë nguy√™n kh√¥ng √¢m
                match.sA = scoreA;
                match.sB = scoreB;
                
                // 2. Ki·ªÉm tra t√≠nh h·ª£p l·ªá
                let isValid = true;
                let winner = '';
                let winnerScore = 0;
                let loserScore = 0;
                let message = '';

                // Ki·ªÉm tra ph·∫°m vi ƒëi·ªÉm s·ªë chung
                if (scoreA > maxOverall || scoreB > maxOverall) {
                    message = `L·ªói: ƒêi·ªÉm s·ªë cho tr·∫≠n **${matchType}** (${match.Mc}) ph·∫£i n·∫±m trong kho·∫£ng 0 ƒë·∫øn ${maxOverall}.`;
                    isValid = false;
                } else if (scoreA === scoreB) {
                    // Tr∆∞·ªùng h·ª£p h√≤a
                    message = `L·ªói: T·ªâ s·ªë **Ho√†** (${scoreA}-${scoreB}) kh√¥ng h·ª£p l·ªá cho th·ªÉ th·ª©c lo·∫°i tr·ª±c ti·∫øp c·ªßa Pickleball.`;
                    isValid = false; 
                } else {
                    // X√°c ƒë·ªãnh ƒë·ªôi th·∫Øng/thua
                    if (scoreA > scoreB) {
                        winner = match.A;
                        winnerScore = scoreA;
                        loserScore = scoreB;
                    } else { // scoreB > scoreA
                        winner = match.B;
                        winnerScore = scoreB;
                        loserScore = scoreA;
                    }

                    // Ki·ªÉm tra r√†ng bu·ªôc ƒëi·ªÉm th·∫Øng/thua theo lu·∫≠t
                    if (winnerScore !== winScore || loserScore > loseMax) {
                        message = `L·ªói: T·ªâ s·ªë kh√¥ng h·ª£p l·ªá cho tr·∫≠n **${matchType}** (${match.Mc}). T·ªâ s·ªë th·∫Øng **ph·∫£i l√† ${winScore}** v√† t·ªâ s·ªë thua **t·ªëi ƒëa l√† ${loseMax}**. T·ªâ s·ªë nh·∫≠p: ${scoreA}-${scoreB}.`;
                        isValid = false;
                    }
                }
                
                if (isValid) {
                    // H·ª£p l·ªá: C·∫≠p nh·∫≠t Wn, l∆∞u tr·ªØ
                    match.Wn = winner;
                    
                    message = `‚úÖ ƒê√£ c·∫≠p nh·∫≠t t·ª∑ s·ªë tr·∫≠n ${match.Mc}: ${match.A} (${match.sA}) - ${match.B} (${match.sB}). ƒê·ªôi th·∫Øng: ${match.Wn}.`;
                    console.log(message);
                    
                    // L∆∞u v√†o Local Storage (v√† t·ª± ƒë·ªông g·ª≠i c·∫£nh b√°o remote)
                    saveMatchesToStorage(matches.value);
                    sendDataToRemoteServer(matches.value); 

                } else {
                    // Kh√¥ng h·ª£p l·ªá: Gi·ªØ nguy√™n Wn v√† b√°o l·ªói
                    match.Wn = ''; 
                    console.error(message.replace(/<[^>]*>?/gm, '')); // Log kh√¥ng HTML
                    
                    showErrorMessage(message);
                }
                
                // K√≠ch ho·∫°t t√≠nh to√°n l·∫°i B·∫£ng X·∫øp H·∫°ng
            };

            return {
                tournament,
                matches,
                standings,
                groupedStandings, 
                updateMatch,
                getMatchGroupName,
                errorMessage,
                isErrorVisible,
                hideErrorMessage
            }
        }
    }).mount('#app')
</script>

</body>
</html>
