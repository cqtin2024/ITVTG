<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITVTG Pickleball Tournament 2025</title>
    <!-- T·∫£i Tailwind CSS ƒë·ªÉ styling v√† responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .tab-button.active { background-color: #0d9488; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .score-input { width: 4rem; text-align: center; font-weight: bold; }
        .group-match-row .team-a-name, .group-match-row .team-b-name { cursor: pointer; }
        .winning-team { font-weight: bold; color: #059669; }
        /* T√πy ch·ªânh cho mobile: Cu·ªôn ngang b·∫£ng v√† ∆∞u ti√™n hi·ªÉn th·ªã d·ªçc */
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; min-width: 600px; border-collapse: collapse; }
        th, td { padding: 8px 6px; text-align: left; border-bottom: 1px solid #e5e7eb; white-space: nowrap; }
        
        @media (min-width: 768px) {
            table { min-width: 100%; }
            th, td { padding: 12px 10px; }
        }
    </style>
</head>
<body class="p-2 md:p-4">

    <!-- HEADER -->
    <header class="text-center py-4 bg-white shadow-md rounded-lg mb-4">
        <h1 class="text-2xl md:text-3xl font-bold text-teal-700">üèÜ Pickleball ITVTG Tournament 2025 üèÜ</h1>
        <p class="text-sm text-gray-600 mt-1">Qu·∫£n l√Ω v√† C·∫≠p nh·∫≠t K·∫øt qu·∫£ Gi·∫£i ƒë·∫•u</p>
    </header>

    <!-- NAVIGATION TABS -->
    <div class="flex flex-wrap justify-center space-x-1 space-y-1 md:space-x-2 p-2 bg-gray-100 rounded-lg mb-4">
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow active" data-tab="info">Th√¥ng tin chung</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="group-a">B·∫£ng A</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="group-b">B·∫£ng B</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="group-c">B·∫£ng C</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="group-d">B·∫£ng D</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="final">V√≤ng Chung k·∫øt</button>
        <button class="tab-button p-2 md:px-4 md:py-2 text-sm font-medium rounded-lg text-teal-700 bg-white shadow" data-tab="config">C·∫•u h√¨nh & Xu·∫•t</button>
    </div>

    <!-- MAIN CONTENT -->
    <div id="content-area" class="bg-white p-4 rounded-lg shadow-xl">

        <!-- 1. INFO TAB -->
        <div id="info" class="tab-content active">
            <h2 class="text-xl font-semibold mb-3 text-teal-600">Th√¥ng Tin Gi·∫£i ƒë·∫•u & Th·ªëng K√™</h2>
            <div id="tournament-details" class="space-y-2 text-gray-700 text-sm md:text-base mb-6 border p-3 rounded-lg bg-teal-50/50">
                <!-- ƒê∆∞·ª£c ƒëi·ªÅn b·ªüi JS -->
            </div>
            
            <h3 class="text-lg font-semibold mb-4 text-teal-600">Th·ªëng K√™ Gi·∫£i Th∆∞·ªüng</h3>
            <div id="trophy-display" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- CHAMPION -->
                <div class="p-3 bg-yellow-100/70 border-l-4 border-yellow-500 rounded-lg shadow-md">
                    <p class="text-sm font-semibold text-yellow-700">ü•á V√¥ ƒë·ªãch (Champion)</p>
                    <p id="champion-team" class="text-lg font-bold text-yellow-800 mt-1">[Ch∆∞a x√°c ƒë·ªãnh]</p>
                </div>
                <!-- RUNNER-UP -->
                <div class="p-3 bg-gray-100/70 border-l-4 border-gray-500 rounded-lg shadow-md">
                    <p class="text-sm font-semibold text-gray-700">ü•à √Å qu√¢n (Runner-Up)</p>
                    <p id="runnerup-team" class="text-lg font-bold text-gray-800 mt-1">[Ch∆∞a x√°c ƒë·ªãnh]</p>
                </div>
                <!-- THIRD PLACE 1 -->
                <div class="p-3 bg-amber-100/70 border-l-4 border-amber-500 rounded-lg shadow-md">
                    <p class="text-sm font-semibold text-amber-700">ü•â ƒê·ªìng h·∫°ng Ba 1</p>
                    <p id="third-place-1-team" class="text-lg font-bold text-amber-800 mt-1">[Ch∆∞a x√°c ƒë·ªãnh]</p>
                </div>
                <!-- THIRD PLACE 2 -->
                <div class="p-3 bg-amber-100/70 border-l-4 border-amber-500 rounded-lg shadow-md">
                    <p class="text-sm font-semibold text-amber-700">ü•â ƒê·ªìng h·∫°ng Ba 2</p>
                    <p id="third-place-2-team" class="text-lg font-bold text-amber-800 mt-1">[Ch∆∞a x√°c ƒë·ªãnh]</p>
                </div>
            </div>
        </div>
        
        <!-- 2. GROUP TABS (A, B, C, D) -->
        <div id="group-a" class="tab-content"></div>
        <div id="group-b" class="tab-content"></div>
        <div id="group-c" class="tab-content"></div>
        <div id="group-d" class="tab-content"></div>

        <!-- 3. FINAL TAB -->
        <div id="final" class="tab-content">
            <h2 class="text-xl font-semibold mb-4 text-teal-600">V√≤ng Chung K·∫øt (T·ª© k·∫øt, B√°n k·∫øt, Chung k·∫øt)</h2>
            <div id="final-knockout-matches">
                <!-- Knockout rounds will be rendered here -->
            </div>
        </div>

        <!-- 4. CONFIG TAB -->
        <div id="config" class="tab-content">
            <h2 class="text-xl font-semibold mb-4 text-teal-600">C·∫•u h√¨nh & C√¥ng c·ª• Qu·∫£n l√Ω</h2>

            <!-- T·ª± ƒë·ªông C·∫≠p nh·∫≠t / Random -->
            <div class="p-4 border rounded-lg mb-6 bg-blue-50/50">
                <h3 class="text-lg font-semibold mb-3 text-blue-700">T·ª± ƒë·ªông C·∫≠p nh·∫≠t K·∫øt qu·∫£ (Random)</h3>
                <p class="text-sm text-gray-600 mb-3">T·∫°o k·∫øt qu·∫£ ng·∫´u nhi√™n h·ª£p l·ªá (11 vs &lt; 11) cho t·∫•t c·∫£ c√°c tr·∫≠n ƒë·∫•u trong v√≤ng ƒë√£ ch·ªçn.</p>
                <select id="random-round-select" class="p-2 border rounded-md mr-3 mb-3 w-full md:w-auto">
                    <option value="GA">V√≤ng B·∫£ng A</option>
                    <option value="GB">V√≤ng B·∫£ng B</option>
                    <option value="GC">V√≤ng B·∫£ng C</option>
                    <option value="GD">V√≤ng B·∫£ng D</option>
                    <option value="QF">T·ª© k·∫øt</option>
                    <option value="SF">B√°n k·∫øt</option>
                    <option value="F">Chung k·∫øt</option>
                    <option value="ALL">T·∫•t c·∫£ c√°c v√≤ng</option>
                </select>
                <button onclick="randomizeScores()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 w-full md:w-auto">
                    K√≠ch ho·∫°t Random & C·∫≠p nh·∫≠t
                </button>
            </div>

            <!-- X√≥a K·∫øt qu·∫£ / Reset -->
            <div class="p-4 border rounded-lg mb-6 bg-red-50/50">
                <h3 class="text-lg font-semibold mb-3 text-red-700">X√≥a K·∫øt qu·∫£ & T√≠nh to√°n l·∫°i</h3>
                <p class="text-sm text-gray-600 mb-3">X√≥a k·∫øt qu·∫£ (Scores, Wn) cho t·∫•t c·∫£ c√°c tr·∫≠n ƒë·∫•u trong v√≤ng ƒë√£ ch·ªçn v√† t√≠nh to√°n l·∫°i BXH.</p>
                <select id="reset-round-select" class="p-2 border rounded-md mr-3 mb-3 w-full md:w-auto">
                    <option value="F">Chung k·∫øt</option>
                    <option value="SF">B√°n k·∫øt</option>
                    <option value="QF">T·ª© k·∫øt</option>
                    <option value="GD">V√≤ng B·∫£ng D</option>
                    <option value="GC">V√≤ng B·∫£ng C</option>
                    <option value="GB">V√≤ng B·∫£ng B</option>
                    <option value="GA">V√≤ng B·∫£ng A</option>
                    <option value="ALL">T·∫•t c·∫£ c√°c v√≤ng</option>
                </select>
                <button onclick="resetScores()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 w-full md:w-auto">
                    X√≥a k·∫øt qu·∫£ & Reset
                </button>
            </div>
            
            <!-- Xu·∫•t D·ªØ li·ªáu CSV -->
            <div class="p-4 border rounded-lg mb-6 bg-green-50/50">
                <h3 class="text-lg font-semibold mb-3 text-green-700">Xu·∫•t D·ªØ li·ªáu (CSV)</h3>
                <p class="text-sm text-gray-600 mb-3">T·∫£i v·ªÅ d·ªØ li·ªáu gi·∫£i ƒë·∫•u hi·ªán t·∫°i d∆∞·ªõi d·∫°ng t·ªáp CSV.</p>
                <button onclick="exportData('tL')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 mb-2 mr-2 w-full md:w-auto">
                    Xu·∫•t Danh s√°ch ƒê·ªôi & Ng∆∞·ªùi ch∆°i
                </button>
                <button onclick="exportData('matches')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 mb-2 mr-2 w-full md:w-auto">
                    Xu·∫•t T·∫•t c·∫£ Tr·∫≠n ƒë·∫•u
                </button>
                <button onclick="exportData('teamStandings')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 mb-2 w-full md:w-auto">
                    Xu·∫•t B·∫£ng x·∫øp h·∫°ng V√≤ng B·∫£ng
                </button>
            </div>
            
            <!-- Ch·ª©c nƒÉng GitHub Save (C·∫ßn Backend) -->
            <div class="p-4 border rounded-lg bg-yellow-50/50">
                <h3 class="text-lg font-semibold mb-3 text-yellow-700">L∆∞u D·ªØ li·ªáu l√™n GitHub</h3>
                <p class="text-sm text-red-600 mb-3 font-semibold">‚ö† L∆∞u √Ω: Ch·ª©c nƒÉng l∆∞u tr·ª±c ti·∫øp l√™n GitHub c·∫ßn c√≥ Backend Server v√† API Token. Ch·ª©c nƒÉng n√†y s·∫Ω ch·ªâ m√¥ ph·ªèng vi·ªác l∆∞u v√† hi·ªÉn th·ªã JSON.</p>
                <label for="github-token" class="block text-sm font-medium text-gray-700">GitHub Personal Access Token:</label>
                <input type="password" id="github-token" class="p-2 border rounded-md w-full my-2" placeholder="Nh·∫≠p token GitHub...">
                <button onclick="saveToGithub()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 w-full md:w-auto">
                    Simulate L∆∞u JSON
                </button>
                <p id="github-message" class="mt-3 text-sm"></p>
                <textarea id="output-json" class="mt-4 w-full h-40 p-2 text-xs border rounded-md bg-gray-50" readonly placeholder="JSON ƒë·∫ßu ra ƒë·ªÉ l∆∞u..."></textarea>
            </div>

        </div>
    </div>

    <!-- GLOBAL MODAL (CUSTOM ALERT/CONFIRM) -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <h3 id="modal-title" class="text-lg font-bold mb-3 text-teal-700">Th√¥ng b√°o</h3>
            <p id="modal-content" class="text-gray-700 mb-4"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 hidden">H·ªßy</button>
                <button id="modal-ok-btn" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">ƒê·ªìng √Ω</button>
            </div>
        </div>
    </div>

    <script>
    // --- D·ªÆ LI·ªÜU JSON G·ªêC (EMBEDDED) ---
    const initialData = {
      "key_legend": { /* ... (D·ªØ li·ªáu ban ƒë·∫ßu) ... */ },
      "TournamentInfo": {
        "TN": "Pickleball ITVTG Tournament 2025",
        "Org": "IT V≈©ng T√†u Goup",
        "LogoL": "https://github.com/cqtin2024/ITVTG/blob/main/LogoITGVT01.png",
        "SD": "26-10-2025",
        "ED": "26-10-2025",
        "FTT": "14:00",
        "VL": "HM Sport - Pickleball & Coffee - 195 V√µ Th·ªã S√°u, V≈©ng T√†u",
        "MapVL": "https://maps.app.goo.gl/KqqrpVqmVi4uNg7s7",
        "GL": "Qu√°n nh·∫≠u Th·ªëng Nh·∫•t - 56 Th·ªëng Nh·∫•t, V≈©ng T√†u ",
        "GT": "18:30",
        "MapGL": "https://maps.app.goo.gl/Zbuo59wSeRsHP6E59"
      },
      "teamStandings": [
        { "g": "A", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3, "GRank": 1, "T": "Team 9", "Tn": "Duy H∆∞ng-Minh T√∫", "PF": 33, "PA": 15, "PD": 18, "seed": "A1" },
        { "g": "A", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3, "GRank": 2, "T": "Team 3", "Tn": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "PF": 29, "PA": 22, "PD": 7, "seed": "A2" },
        { "g": "A", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3, "GRank": 3, "T": "Team 11", "Tn": "Minh Chang-Minh Ch√¢u", "PF": 20, "PA": 29, "PD": -9, "seed": "A3" },
        { "g": "A", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3, "GRank": 4, "T": "Team 5", "Tn": "Qu·ªëc Kh√°nh-Linh V≈©", "PF": 15, "PA": 31, "PD": -16, "seed": "A4" },
        
        { "g": "B", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3, "GRank": 1, "T": "Team 4", "Tn": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "PF": 33, "PA": 12, "PD": 21, "seed": "B1" },
        { "g": "B", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3, "GRank": 2, "T": "Team 7", "Tn": "Qu·ªëc H√πng-ƒê·ª©c Duy", "PF": 28, "PA": 20, "PD": 8, "seed": "B2" },
        { "g": "B", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3, "GRank": 3, "T": "Team 12", "Tn": "Thanh S∆°n-Khoa Ti·∫øn", "PF": 17, "PA": 30, "PD": -13, "seed": "B3" },
        { "g": "B", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3, "GRank": 4, "T": "Team 1", "Tn": "Quang Ti·∫øn-T·∫•t Th√†nh", "PF": 13, "PA": 29, "PD": -16, "seed": "B4" },
        
        { "g": "C", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3, "GRank": 1, "T": "Team 16", "Tn": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "PF": 33, "PA": 10, "PD": 23, "seed": "C1" },
        { "g": "C", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3, "GRank": 2, "T": "Team 10", "Tn": "L√™ Duy-Thanh V∆∞∆°ng", "PF": 27, "PA": 18, "PD": 9, "seed": "C2" },
        { "g": "C", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3, "GRank": 3, "T": "Team 14", "Tn": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "PF": 16, "PA": 29, "PD": -13, "seed": "C3" },
        { "g": "C", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3, "GRank": 4, "T": "Team 6", "Tn": "ƒê√¥ng Chu-Ng·ªçc H√πng", "PF": 10, "PA": 29, "PD": -19, "seed": "C4" },
        
        { "g": "D", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3, "GRank": 1, "T": "Team 13", "Tn": "B√° Ch√¢u-Hi·ªÅn Phong", "PF": 33, "PA": 14, "PD": 19, "seed": "D1" },
        { "g": "D", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3, "GRank": 2, "T": "Team 8", "Tn": "Ti·∫øn M·∫°nh-Quang T√≠n", "PF": 28, "PA": 19, "PD": 9, "seed": "D2" },
        { "g": "D", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3, "GRank": 3, "T": "Team 15", "Tn": "Minh Thi·ªán-Duy Minh", "PF": 15, "PA": 30, "PD": -15, "seed": "D3" },
        { "g": "D", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3, "GRank": 4, "T": "Team 2", "Tn": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "PF": 12, "PA": 31, "PD": -19, "seed": "D4" }
      ],
      "matches": [
        // GROUP A
        { "Mc": "GA1", "r": "GA", "t": "14:15", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": "11", "B": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sB": "5", "Wn": "Duy H∆∞ng-Minh T√∫" },
        { "Mc": "GA2", "r": "GA", "t": "14:15", "c": "S4", "A": "Minh Chang-Minh Ch√¢u", "sA": "11", "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": "7", "Wn": "Minh Chang-Minh Ch√¢u" },
        { "Mc": "GA3", "r": "GA", "t": "14:45", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": "11", "B": "Minh Chang-Minh Ch√¢u", "sB": "6", "Wn": "Duy H∆∞ng-Minh T√∫" },
        { "Mc": "GA4", "r": "GA", "t": "14:45", "c": "S4", "A": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sA": "11", "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": "4", "Wn": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng" },
        { "Mc": "GA5", "r": "GA", "t": "15:15", "c": "S3", "A": "Duy H∆∞ng-Minh T√∫", "sA": "11", "B": "Qu·ªëc Kh√°nh-Linh V≈©", "sB": "4", "Wn": "Duy H∆∞ng-Minh T√∫" },
        { "Mc": "GA6", "r": "GA", "t": "15:15", "c": "S4", "A": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng", "sA": "11", "B": "Minh Chang-Minh Ch√¢u", "sB": "3", "Wn": "Qu·ªëc Th·ªãnh-Minh Ph∆∞∆°ng" },
        
        // GROUP B
        { "Mc": "GB1", "r": "GB", "t": "14:30", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": "11", "B": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sB": "5", "Wn": "Qu√≠ Tu·∫•n-M·∫°nh H√πng" },
        { "Mc": "GB2", "r": "GB", "t": "14:30", "c": "S4", "A": "Thanh S∆°n-Khoa Ti·∫øn", "sA": "11", "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": "6", "Wn": "Thanh S∆°n-Khoa Ti·∫øn" },
        { "Mc": "GB3", "r": "GB", "t": "15:00", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": "11", "B": "Thanh S∆°n-Khoa Ti·∫øn", "sB": "4", "Wn": "Qu√≠ Tu·∫•n-M·∫°nh H√πng" },
        { "Mc": "GB4", "r": "GB", "t": "15:00", "c": "S4", "A": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sA": "11", "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": "7", "Wn": "Qu·ªëc H√πng-ƒê·ª©c Duy" },
        { "Mc": "GB5", "r": "GB", "t": "15:30", "c": "S3", "A": "Qu√≠ Tu·∫•n-M·∫°nh H√πng", "sA": "11", "B": "Quang Ti·∫øn-T·∫•t Th√†nh", "sB": "0", "Wn": "Qu√≠ Tu·∫•n-M·∫°nh H√πng" },
        { "Mc": "GB6", "r": "GB", "t": "15:30", "c": "S4", "A": "Qu·ªëc H√πng-ƒê·ª©c Duy", "sA": "11", "B": "Thanh S∆°n-Khoa Ti·∫øn", "sB": "2", "Wn": "Qu·ªëc H√πng-ƒê·ª©c Duy" },
        
        // GROUP C
        { "Mc": "GC1", "r": "GC", "t": "14:15", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": "11", "B": "L√™ Duy-Thanh V∆∞∆°ng", "sB": "3", "Wn": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng" },
        { "Mc": "GC2", "r": "GC", "t": "14:15", "c": "S6", "A": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sA": "11", "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": "5", "Wn": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng" },
        { "Mc": "GC3", "r": "GC", "t": "14:45", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": "11", "B": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sB": "3", "Wn": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng" },
        { "Mc": "GC4", "r": "GC", "t": "14:45", "c": "S6", "A": "L√™ Duy-Thanh V∆∞∆°ng", "sA": "11", "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": "3", "Wn": "L√™ Duy-Thanh V∆∞∆°ng" },
        { "Mc": "GC5", "r": "GC", "t": "15:15", "c": "S5", "A": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng", "sA": "11", "B": "ƒê√¥ng Chu-Ng·ªçc H√πng", "sB": "2", "Wn": "Ho√†ng Thanh-C√¥ng Ph∆∞∆°ng" },
        { "Mc": "GC6", "r": "GC", "t": "15:15", "c": "S6", "A": "L√™ Duy-Thanh V∆∞∆°ng", "sA": "11", "B": "VƒÉn C∆∞·ªùng-VƒÉn D≈©ng", "sB": "2", "Wn": "L√™ Duy-Thanh V∆∞∆°ng" },
        
        // GROUP D
        { "Mc": "GD1", "r": "GD", "t": "14:30", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": "11", "B": "Ti·∫øn M·∫°nh-Quang T√≠n", "sB": "6", "Wn": "B√° Ch√¢u-Hi·ªÅn Phong" },
        { "Mc": "GD2", "r": "GD", "t": "14:30", "c": "S6", "A": "Minh Thi·ªán-Duy Minh", "sA": "8", "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": "11", "Wn": "Vi·∫øt Tu·∫•n-Quang D≈©ng" },
        { "Mc": "GD3", "r": "GD", "t": "15:00", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": "11", "B": "Minh Thi·ªán-Duy Minh", "sB": "5", "Wn": "B√° Ch√¢u-Hi·ªÅn Phong" },
        { "Mc": "GD4", "r": "GD", "t": "15:00", "c": "S6", "A": "Ti·∫øn M·∫°nh-Quang T√≠n", "sA": "11", "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": "4", "Wn": "Ti·∫øn M·∫°nh-Quang T√≠n" },
        { "Mc": "GD5", "r": "GD", "t": "15:30", "c": "S5", "A": "B√° Ch√¢u-Hi·ªÅn Phong", "sA": "11", "B": "Vi·∫øt Tu·∫•n-Quang D≈©ng", "sB": "8", "Wn": "B√° Ch√¢u-Hi·ªÅn Phong" },
        { "Mc": "GD6", "r": "GD", "t": "15:30", "c": "S6", "A": "Ti·∫øn M·∫°nh-Quang T√≠n", "sA": "11", "B": "Minh Thi·ªán-Duy Minh", "sB": "2", "Wn": "Ti·∫øn M·∫°nh-Quang T√≠n" },

        // KNOCKOUT (Group Winners/Runners-Up are placeholders for now)
        { "Mc": "QF1", "r": "QF", "t": "15:45", "c": "S3", "A": "W.A", "sA": "0", "B": "R.B", "sB": "0", "Wn": "" },
        { "Mc": "QF2", "r": "QF", "t": "15:45", "c": "S4", "A": "W.B", "sA": "0", "B": "R.A", "sB": "0", "Wn": "" },
        { "Mc": "QF3", "r": "QF", "t": "16:00", "c": "S5", "A": "W.C", "sA": "0", "B": "R.D", "sB": "0", "Wn": "" },
        { "Mc": "QF4", "r": "QF", "t": "16:00", "c": "S6", "A": "W.D", "sA": "0", "B": "R.C", "sB": "0", "Wn": "" },

        // SEMI-FINAL
        { "Mc": "SF1", "r": "SF", "t": "16:10", "c": "S4", "A": "W.QF1", "sA": "0", "B": "W.QF3", "sB": "0", "Wn": "" },
        { "Mc": "SF2", "r": "SF", "t": "16:25", "c": "S5", "A": "W.QF2", "sA": "0", "B": "W.QF4", "sB": "0", "Wn": "" },

        // FINAL
        { "Mc": "F", "r": "F", "t": "17:05", "c": "S5", "A": "W.SF1", "sA": "0", "B": "W.SF2", "sB": "0", "Wn": "", "rU": "" }
      ],
      "tL": [ /* ... (D·ªØ li·ªáu ban ƒë·∫ßu) ... */ ]
    };

    // --- GLOBAL STATE ---
    let tournamentState = JSON.parse(JSON.stringify(initialData));
    const TEAMS_BY_TN = {}; // Map Nickname to Team ID
    const TEAMS_BY_SEED = {}; // Map Seed (A1, B2) to Team Nickname

    // --- UTILITY FUNCTIONS ---

    // H√†m t√πy ch·ªânh hi·ªÉn th·ªã th√¥ng b√°o thay cho alert/confirm
    function showModal(title, content, isConfirm = false, onOk, onCancel) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-content').textContent = content;
        
        const modal = document.getElementById('modal');
        const okBtn = document.getElementById('modal-ok-btn');
        const cancelBtn = document.getElementById('modal-cancel-btn');

        okBtn.onclick = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            if (onOk) onOk();
        };

        if (isConfirm) {
            cancelBtn.classList.remove('hidden');
            cancelBtn.onclick = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                if (onCancel) onCancel();
            };
        } else {
            cancelBtn.classList.add('hidden');
        }

        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
    
    // Convert array of objects to CSV string
    function convertToCSV(objArray) {
        const array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
        let str = '';

        // Header
        const header = Object.keys(array[0]);
        str += header.join(',') + '\r\n';

        // Rows
        for (let i = 0; i < array.length; i++) {
            let line = '';
            for (let index in array[i]) {
                if (line != '') line += ',';
                // X·ª≠ l√Ω gi√° tr·ªã c√≥ ch·ª©a d·∫•u ph·∫©y
                let value = array[i][index];
                if (typeof value === 'object' && value !== null) {
                    value = JSON.stringify(value).replace(/"/g, '""');
                } else if (typeof value === 'string') {
                    value = value.replace(/"/g, '""');
                }
                line += '"' + value + '"';
            }
            str += line + '\r\n';
        }

        return str;
    }

    // Download CSV file
    function downloadCSV(csv, filename) {
        const csvFile = new Blob(["\ufeff" + csv], { type: "text/csv;charset=utf-8;" }); // Th√™m BOM cho UTF-8
        const downloadLink = document.createElement("a");
        downloadLink.download = filename;
        downloadLink.href = window.URL.createObjectURL(csvFile);
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
    }
    
    // --- CORE LOGIC ---

    // 1. Kh·ªüi t·∫°o State v√† Map d·ªØ li·ªáu
    function initializeState() {
        tournamentState.tL.forEach(team => {
            TEAMS_BY_TN[team.Tn] = team.T;
            TEAMS_BY_SEED[team.seed] = team.Tn;
        });

        // ƒê·∫£m b·∫£o t·∫•t c·∫£ c√°c tr·∫≠n ƒë·∫•u v√≤ng b·∫£ng c√≥ r (Round Code)
        tournamentState.matches.forEach(match => {
            if (match.Mc.startsWith('G') && !match.r) {
                match.r = match.Mc.substring(0, 2);
            }
        });

        // T√≠nh to√°n l·∫°i BXH ban ƒë·∫ßu (ho·∫∑c sau khi reset)
        recalculateGroupStandings();
        updateKnockoutParticipants();
    }
    
    // 2. T√≠nh to√°n l·∫°i BXH V√≤ng B·∫£ng
    function recalculateGroupStandings() {
        const groupStats = {};

        // Kh·ªüi t·∫°o stats cho t·∫•t c·∫£ c√°c ƒë·ªôi
        tournamentState.tL.forEach(team => {
            groupStats[team.Tn] = { W: 0, L: 0, PF: 0, PA: 0, Pts: 0, mP: 0, HS: 0 };
        });

        // T√≠nh ƒëi·ªÉm t·ª´ c√°c tr·∫≠n ƒë·∫•u v√≤ng b·∫£ng
        const groupMatches = tournamentState.matches.filter(m => m.r.startsWith('G'));
        groupMatches.forEach(match => {
            const teamA = match.A;
            const teamB = match.B;
            const sA = parseInt(match.sA);
            const sB = parseInt(match.sB);

            if (!groupStats[teamA] || !groupStats[teamB] || match.Wn === "") return; // B·ªè qua n·∫øu ch∆∞a c√≥ k·∫øt qu·∫£

            groupStats[teamA].mP++;
            groupStats[teamB].mP++;
            groupStats[teamA].PF += sA;
            groupStats[teamA].PA += sB;
            groupStats[teamB].PF += sB;
            groupStats[teamB].PA += sA;

            if (match.Wn === teamA) {
                groupStats[teamA].W++;
                groupStats[teamB].L++;
                groupStats[teamA].Pts += 3;
                groupStats[teamA].HS = Math.max(groupStats[teamA].HS, sA);
            } else if (match.Wn === teamB) {
                groupStats[teamB].W++;
                groupStats[teamA].L++;
                groupStats[teamB].Pts += 3;
                groupStats[teamB].HS = Math.max(groupStats[teamB].HS, sB);
            }
        });

        // C·∫≠p nh·∫≠t v√† x·∫øp h·∫°ng (theo W, sau ƒë√≥ PD, sau ƒë√≥ PF)
        ['A', 'B', 'C', 'D'].forEach(groupCode => {
            let teamsInGroup = tournamentState.teamStandings.filter(t => t.g === groupCode);

            teamsInGroup.forEach(team => {
                const stats = groupStats[team.Tn];
                if (stats) {
                    team.W = stats.W;
                    team.L = stats.L;
                    team.Pts = stats.Pts;
                    team.mP = stats.mP;
                    team.PF = stats.PF;
                    team.PA = stats.PA;
                    team.PD = stats.PF - stats.PA;
                    team.HS = stats.HS;
                }
            });

            // S·∫Øp x·∫øp theo: Pts (Gi·∫£m d·∫ßn), PD (Gi·∫£m d·∫ßn), PF (Gi·∫£m d·∫ßn)
            teamsInGroup.sort((a, b) => {
                if (b.Pts !== a.Pts) return b.Pts - a.Pts;
                if (b.PD !== a.PD) return b.PD - a.PD;
                return b.PF - a.PF;
            });

            // C·∫≠p nh·∫≠t Group Rank
            teamsInGroup.forEach((team, index) => {
                team.GRank = index + 1;
            });
        });

        // S·∫Øp x·∫øp l·∫°i tournamentState.teamStandings theo Group v√† Rank
        tournamentState.teamStandings.sort((a, b) => {
            if (a.g < b.g) return -1;
            if (a.g > b.g) return 1;
            return a.GRank - b.GRank;
        });
    }

    // 3. C·∫≠p nh·∫≠t ƒë·ªôi tham gia v√≤ng lo·∫°i tr·ª±c ti·∫øp
    function updateKnockoutParticipants() {
        const getTeamByRank = (group, rank) => {
            const team = tournamentState.teamStandings.find(t => t.g === group && t.GRank === rank);
            return team ? team.Tn : `W.${group}` === 'W.' + group ? `W.${group}` : `R.${group}`;
        };

        const groupWinners = {
            'W.A': getTeamByRank('A', 1), 'R.A': getTeamByRank('A', 2),
            'W.B': getTeamByRank('B', 1), 'R.B': getTeamByRank('B', 2),
            'W.C': getTeamByRank('C', 1), 'R.C': getTeamByRank('C', 2),
            'W.D': getTeamByRank('D', 1), 'R.D': getTeamByRank('D', 2),
        };

        const knockoutMatches = tournamentState.matches.filter(m => ['QF', 'SF', 'F'].includes(m.r));

        knockoutMatches.forEach(match => {
            let teamA = match.A;
            let teamB = match.B;

            // V√≤ng T·ª© k·∫øt (QF)
            if (match.r === 'QF') {
                match.A = groupWinners[match.A] || match.A;
                match.B = groupWinners[match.B] || match.B;
            }

            // V√≤ng B√°n k·∫øt (SF) v√† Chung k·∫øt (F)
            if (['SF', 'F'].includes(match.r) && match.A.startsWith('W.QF') || match.A.startsWith('W.SF')) {
                const winnerA = tournamentState.matches.find(m => m.Mc === match.A.substring(2))?.Wn || match.A;
                const winnerB = tournamentState.matches.find(m => m.Mc === match.B.substring(2))?.Wn || match.B;
                
                match.A = winnerA;
                match.B = winnerB;
            }

            // C·∫≠p nh·∫≠t ng∆∞·ªùi thua ·ªü tr·∫≠n Chung k·∫øt cho √Å qu√¢n
            if (match.r === 'F' && match.Wn && match.rU) {
                match.rU = match.Wn === match.A ? match.B : match.A;
            }
        });
    }

    // 4. C·∫≠p nh·∫≠t T·ªâ s·ªë Tr·∫≠n ƒë·∫•u Th·ªß c√¥ng
    function updateMatchScore(mc, sA, sB) {
        const match = tournamentState.matches.find(m => m.Mc === mc);
        if (!match) {
            showModal("L·ªói C·∫≠p nh·∫≠t", `Kh√¥ng t√¨m th·∫•y M√£ Tr·∫≠n ${mc}. Vui l√≤ng ki·ªÉm tra l·∫°i.`, false);
            return false;
        }

        sA = parseInt(sA);
        sB = parseInt(sB);

        // Validation: Winner score = 11, Loser score < 11
        if (sA === 11 && sB < 11) {
            match.sA = sA.toString();
            match.sB = sB.toString();
            match.Wn = match.A;
        } else if (sB === 11 && sA < 11) {
            match.sA = sA.toString();
            match.sB = sB.toString();
            match.Wn = match.B;
        } else {
            showModal("L·ªói T·ªâ s·ªë", `T·ªâ s·ªë kh√¥ng h·ª£p l·ªá (${sA}-${sB}). T·ªâ s·ªë ph·∫£i l√† 11 - X (v·ªõi X < 11).`, false);
            return false;
        }

        // N·∫øu l√† tr·∫≠n v√≤ng b·∫£ng, t√≠nh to√°n l·∫°i BXH
        if (match.r.startsWith('G')) {
            recalculateGroupStandings();
        }
        
        // Lu√¥n c·∫≠p nh·∫≠t l·∫°i ng∆∞·ªùi tham gia v√≤ng Knockout ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√°n ti·∫øp theo
        updateKnockoutParticipants();
        
        // Render l·∫°i giao di·ªán
        renderApp();
        showModal("Th√†nh c√¥ng", `ƒê√£ c·∫≠p nh·∫≠t t·ªâ s·ªë tr·∫≠n ${mc}: ${match.A} ${sA} - ${sB} ${match.B}. Ng∆∞·ªùi th·∫Øng: ${match.Wn}.`, false);
        return true;
    }

    // 5. T√≠nh to√°n k·∫øt qu·∫£ Chung cu·ªôc (V√¥ ƒë·ªãch, √Å qu√¢n, Gi·∫£i Ba)
    function calculateFinalResults() {
        const finalMatch = tournamentState.matches.find(m => m.r === 'F');
        const sfMatches = tournamentState.matches.filter(m => m.r === 'SF');

        const results = {
            champion: finalMatch?.Wn || "[Ch∆∞a x√°c ƒë·ªãnh]",
            runnerUp: finalMatch?.rU || "[Ch∆∞a x√°c ƒë·ªãnh]",
            thirdPlace: []
        };
        
        // T√¨m 2 ƒë·ªôi thua B√°n k·∫øt (gi·∫£i Ba ƒë·ªìng h·∫°ng)
        sfMatches.forEach(match => {
            if (match.Wn && match.A !== match.Wn) {
                results.thirdPlace.push(match.A);
            }
            if (match.Wn && match.B !== match.Wn) {
                results.thirdPlace.push(match.B);
            }
        });

        // X√≥a tr√πng l·∫∑p (n·∫øu c√≥ l·ªói logic)
        results.thirdPlace = [...new Set(results.thirdPlace)].filter(t => t.startsWith('W.QF') === false);
        
        return results;
    }


    // --- RENDERING FUNCTIONS ---

    // Chuy·ªÉn Tab
    function changeTab(targetTabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(targetTabId).classList.add('active');
        
        document.querySelectorAll('.tab-button').forEach(btn => {
            if (btn.getAttribute('data-tab') === targetTabId) {
                btn.classList.add('active', 'bg-teal-600', 'text-white');
                btn.classList.remove('bg-white', 'text-teal-700');
            } else {
                btn.classList.remove('active', 'bg-teal-600', 'text-white');
                btn.classList.add('bg-white', 'text-teal-700');
            }
        });
    }

    // Render Tab Info
    function renderInfoTab() {
        const info = tournamentState.TournamentInfo;
        const totalTeams = tournamentState.tL.length;
        const detailsHtml = `
            <p><span class="font-bold">Gi·∫£i ƒë·∫•u:</span> ${info.TN}</p>
            <p><span class="font-bold">S·ªë ƒë·ªôi tham gia:</span> ${totalTeams} ƒë·ªôi</p>
            <p><span class="font-bold">Ng√†y & Th·ªùi gian:</span> ${info.SD} - ${info.ED} (${info.FTT})</p>
            <p><span class="font-bold">ƒê·ªãa ƒëi·ªÉm thi ƒë·∫•u:</span> <a href="${info.MapVL}" target="_blank" class="text-blue-500 hover:underline">${info.VL}</a></p>
            <p><span class="font-bold">ƒê·ªãa ƒëi·ªÉm Gala:</span> <a href="${info.MapGL}" target="_blank" class="text-blue-500 hover:underline">${info.GL}</a> (${info.GT})</p>
        `;
        document.getElementById('tournament-details').innerHTML = detailsHtml;

        // Render k·∫øt qu·∫£ chung cu·ªôc
        const finalResults = calculateFinalResults();
        document.getElementById('champion-team').textContent = finalResults.champion;
        document.getElementById('runnerup-team').textContent = finalResults.runnerUp;
        document.getElementById('third-place-1-team').textContent = finalResults.thirdPlace[0] || "[Ch∆∞a x√°c ƒë·ªãnh]";
        document.getElementById('third-place-2-team').textContent = finalResults.thirdPlace[1] || "[Ch∆∞a x√°c ƒë·ªãnh]";
    }

    // Render Tab Group (A, B, C, D)
    function renderGroupTab(groupCode) {
        const tabElement = document.getElementById(`group-${groupCode.toLowerCase()}`);
        const groupTeams = tournamentState.teamStandings.filter(t => t.g === groupCode).sort((a, b) => a.GRank - b.GRank);
        const groupMatches = tournamentState.matches.filter(m => m.r === `G${groupCode}`).sort((a, b) => a.Mc.localeCompare(b.Mc));

        let html = `<h2 class="text-xl font-semibold mb-4 text-teal-600">B·∫£ng ${groupCode}</h2>`;

        // 1. B·∫£ng x·∫øp h·∫°ng
        html += `<h3 class="text-lg font-medium mb-2 text-gray-700">B·∫£ng x·∫øp h·∫°ng</h3>`;
        html += `<div class="table-wrapper mb-6"><table class="text-sm md:text-base bg-white shadow-sm rounded-lg overflow-hidden">
                    <thead class="bg-teal-500 text-white">
                        <tr>
                            <th class="rounded-tl-lg">H·∫°ng</th>
                            <th>T√™n ƒê·ªôi</th>
                            <th>Th·∫Øng</th>
                            <th>Thua</th>
                            <th>PF (ƒê∆∞·ª£c)</th>
                            <th>PA (M·∫•t)</th>
                            <th class="rounded-tr-lg">PD (Hi·ªáu s·ªë)</th>
                        </tr>
                    </thead><tbody>`;
        
        groupTeams.forEach(team => {
            const teamInfo = tournamentState.tL.find(t => t.Tn === team.Tn);
            const teamId = teamInfo ? teamInfo.T : team.T;
            html += `<tr class="hover:bg-gray-50 transition duration-100">
                        <td class="font-bold text-center">${team.GRank}</td>
                        <td title="${teamId}">${team.Tn}</td>
                        <td class="text-center">${team.W}</td>
                        <td class="text-center">${team.L}</td>
                        <td class="text-center">${team.PF}</td>
                        <td class="text-center">${team.PA}</td>
                        <td class="font-semibold text-center ${team.PD > 0 ? 'text-green-600' : team.PD < 0 ? 'text-red-600' : 'text-gray-500'}">${team.PD}</td>
                    </tr>`;
        });
        html += `</tbody></table></div>`;

        // 2. B·∫£ng tr·∫≠n ƒë·∫•u & C·∫≠p nh·∫≠t
        html += `<h3 class="text-lg font-medium mb-2 text-gray-700">K·∫øt qu·∫£ tr·∫≠n ƒë·∫•u & C·∫≠p nh·∫≠t</h3>`;
        html += `<div class="table-wrapper"><table class="text-sm md:text-base bg-white shadow-sm rounded-lg overflow-hidden">
                    <thead class="bg-gray-700 text-white">
                        <tr>
                            <th>Match & Mc</th>
                            <th>TG</th>
                            <th>S√¢n</th>
                            <th colspan="3" class="text-center">T·ªâ s·ªë & C·∫≠p nh·∫≠t</th>
                            <th>Th·∫Øng</th>
                            <th></th>
                        </tr>
                    </thead><tbody>`;

        groupMatches.forEach(match => {
            const isWinnerA = match.Wn === match.A;
            const isWinnerB = match.Wn === match.B;
            
            html += `<tr class="group-match-row hover:bg-gray-50 transition duration-100" data-mc="${match.Mc}">
                        <td>${match.Mc}</td>
                        <td>${match.t}</td>
                        <td>${match.c}</td>
                        <td class="team-a-name ${isWinnerA ? 'winning-team' : ''}">${match.A}</td>
                        <td class="score-input-cell">
                            <input type="number" min="0" max="11" value="${match.sA}" class="score-input p-1 border rounded-md" data-team="A">
                            <span class="mx-1">-</span>
                            <input type="number" min="0" max="11" value="${match.sB}" class="score-input p-1 border rounded-md" data-team="B">
                        </td>
                        <td class="team-b-name ${isWinnerB ? 'winning-team' : ''}">${match.B}</td>
                        <td class="match-winner-name text-center font-bold text-teal-600">${match.Wn || '...'}</td>
                        <td>
                            <button onclick="handleManualUpdate('${match.Mc}')" class="update-btn bg-teal-500 hover:bg-teal-600 text-white text-xs font-bold py-1 px-2 rounded-md transition duration-150">C·∫≠p nh·∫≠t</button>
                        </td>
                    </tr>`;
        });

        html += `</tbody></table></div>`;
        tabElement.innerHTML = html;
    }

    // Render Tab Final (QF, SF, F)
    function renderFinalTab() {
        const tabElement = document.getElementById('final-knockout-matches');
        const knockoutMatches = tournamentState.matches.filter(m => ['QF', 'SF', 'F'].includes(m.r));
        
        let html = '';
        const rounds = { 'QF': 'T·ª© k·∫øt', 'SF': 'B√°n k·∫øt', 'F': 'Chung k·∫øt' };

        Object.keys(rounds).forEach(roundCode => {
            const matchesInRound = knockoutMatches.filter(m => m.r === roundCode).sort((a, b) => a.Mc.localeCompare(b.Mc));
            
            if (matchesInRound.length > 0) {
                html += `<h3 class="text-lg font-medium my-4 p-2 bg-gray-100 border-l-4 border-teal-500 text-gray-700">${rounds[roundCode]}</h3>`;
                html += `<div class="table-wrapper mb-6"><table class="text-sm md:text-base bg-white shadow-sm rounded-lg overflow-hidden">
                            <thead class="bg-teal-500 text-white">
                                <tr>
                                    <th>Mc</th>
                                    <th>TG</th>
                                    <th>S√¢n</th>
                                    <th colspan="3" class="text-center">Tr·∫≠n ƒë·∫•u & C·∫≠p nh·∫≠t T·ªâ s·ªë</th>
                                    <th>Th·∫Øng</th>
                                    <th></th>
                                </tr>
                            </thead><tbody>`;
                
                matchesInRound.forEach(match => {
                    const isWinnerA = match.Wn === match.A;
                    const isWinnerB = match.Wn === match.B;
                    
                    html += `<tr class="group-match-row hover:bg-gray-50 transition duration-100" data-mc="${match.Mc}">
                                <td>${match.Mc}</td>
                                <td>${match.t}</td>
                                <td>${match.c}</td>
                                <td class="team-a-name ${isWinnerA ? 'winning-team' : ''}">${match.A}</td>
                                <td class="score-input-cell">
                                    <input type="number" min="0" max="11" value="${match.sA}" class="score-input p-1 border rounded-md" data-team="A">
                                    <span class="mx-1">-</span>
                                    <input type="number" min="0" max="11" value="${match.sB}" class="score-input p-1 border rounded-md" data-team="B">
                                </td>
                                <td class="team-b-name ${isWinnerB ? 'winning-team' : ''}">${match.B}</td>
                                <td class="match-winner-name text-center font-bold text-teal-600">${match.Wn || '...'}</td>
                                <td>
                                    <button onclick="handleManualUpdate('${match.Mc}')" class="update-btn bg-teal-500 hover:bg-teal-600 text-white text-xs font-bold py-1 px-2 rounded-md transition duration-150">C·∫≠p nh·∫≠t</button>
                                </td>
                            </tr>`;
                });
                
                html += `</tbody></table></div>`;
            }
        });

        tabElement.innerHTML = html;
    }

    // H√†m t·ªïng h·ª£p Render
    function renderApp() {
        // C·∫≠p nh·∫≠t c√°c danh s√°ch ƒë·ªôi cho v√≤ng lo·∫°i
        updateKnockoutParticipants();

        // Render t·∫•t c·∫£ c√°c tab c·∫ßn d·ªØ li·ªáu ƒë·ªông
        renderInfoTab();
        renderGroupTab('A');
        renderGroupTab('B');
        renderGroupTab('C');
        renderGroupTab('D');
        renderFinalTab();
    }


    // --- EVENT HANDLERS ---

    // X·ª≠ l√Ω C·∫≠p nh·∫≠t th·ªß c√¥ng (khi b·∫•m n√∫t "C·∫≠p nh·∫≠t" trong b·∫£ng)
    window.handleManualUpdate = (mc) => {
        const row = document.querySelector(`tr[data-mc="${mc}"]`);
        const sA = row.querySelector('input[data-team="A"]').value;
        const sB = row.querySelector('input[data-team="B"]').value;

        updateMatchScore(mc, sA, sB);
    };

    // X·ª≠ l√Ω C·∫≠p nh·∫≠t Ng·∫´u nhi√™n
    window.randomizeScores = () => {
        const roundCode = document.getElementById('random-round-select').value;
        const roundsToUpdate = roundCode === 'ALL' ? ['GA', 'GB', 'GC', 'GD', 'QF', 'SF', 'F'] : [roundCode];
        let updatedCount = 0;

        const executeRandomUpdate = (r) => {
            const matchesInRound = tournamentState.matches.filter(m => m.r === r);

            matchesInRound.forEach(match => {
                // Ch·ªâ random n·∫øu ch∆∞a c√≥ k·∫øt qu·∫£ (ho·∫∑c ƒë·ªôi ch∆∞a ƒë∆∞·ª£c x√°c ƒë·ªãnh ·ªü v√≤ng KO)
                if (match.Wn === "" || match.A.startsWith('W.') || match.B.startsWith('R.')) {
                    
                    // X√°c ƒë·ªãnh l·∫°i ƒë·ªôi tham gia n·∫øu c·∫ßn (quan tr·ªçng cho QF, SF, F)
                    updateKnockoutParticipants();
                    
                    // Ki·ªÉm tra l·∫°i sau khi updateKnockoutParticipants
                    if (match.A.startsWith('W.') || match.B.startsWith('R.')) return;

                    // T·∫°o t·ªâ s·ªë ng·∫´u nhi√™n h·ª£p l·ªá (11 vs X < 11)
                    let scoreA, scoreB;
                    // L·ª±a ch·ªçn ƒë·ªôi th·∫Øng ng·∫´u nhi√™n
                    if (Math.random() < 0.5) { // A th·∫Øng
                        scoreA = 11;
                        scoreB = Math.floor(Math.random() * 11); // 0-10
                    } else { // B th·∫Øng
                        scoreB = 11;
                        scoreA = Math.floor(Math.random() * 11); // 0-10
                    }
                    
                    match.sA = scoreA.toString();
                    match.sB = scoreB.toString();
                    match.Wn = scoreA > scoreB ? match.A : match.B;
                    
                    updatedCount++;
                }
            });
            return updatedCount;
        };

        // Random theo th·ª© t·ª±: GA -> GD -> QF -> SF -> F ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu v√≤ng sau l√† h·ª£p l·ªá
        const sortedRounds = ['GA', 'GB', 'GC', 'GD', 'QF', 'SF', 'F'];
        sortedRounds.forEach(r => {
            if (roundsToUpdate.includes(r)) {
                executeRandomUpdate(r);
            }
        });

        // Sau khi random, c·∫ßn t√≠nh to√°n l·∫°i BXH v√≤ng b·∫£ng (n·∫øu c√≥ c·∫≠p nh·∫≠t)
        if (roundsToUpdate.some(r => r.startsWith('G'))) {
            recalculateGroupStandings();
        }
        
        // C·∫≠p nh·∫≠t l·∫°i ng∆∞·ªùi tham gia v√≤ng lo·∫°i (r√†ng bu·ªôc W.QF1, W.SF1...)
        updateKnockoutParticipants();
        
        renderApp();
        showModal("Ho√†n t·∫•t Random", `ƒê√£ t·∫°o k·∫øt qu·∫£ ng·∫´u nhi√™n v√† c·∫≠p nh·∫≠t ${updatedCount} tr·∫≠n ƒë·∫•u trong v√≤ng ${roundCode}.`, false);
    };

    // X·ª≠ l√Ω Reset T·ªâ s·ªë
    window.resetScores = () => {
        const roundCode = document.getElementById('reset-round-select').value;
        const roundsToReset = roundCode === 'ALL' ? ['F', 'SF', 'QF', 'GD', 'GC', 'GB', 'GA'] : [roundCode];

        showModal(
            "X√°c nh·∫≠n Reset", 
            `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA k·∫øt qu·∫£ c·ªßa t·∫•t c·∫£ c√°c tr·∫≠n ƒë·∫•u thu·ªôc v√≤ng ${roundCode} v√† t√≠nh to√°n l·∫°i? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!`, 
            true, 
            () => {
                let resetCount = 0;
                
                // Reset theo th·ª© t·ª± F -> SF -> QF -> GD -> GA ƒë·ªÉ ƒë·∫£m b·∫£o lu·ªìng logic
                const sortedRounds = ['F', 'SF', 'QF', 'GD', 'GC', 'GB', 'GA'];
                sortedRounds.forEach(r => {
                    if (roundsToReset.includes(r)) {
                        tournamentState.matches.filter(m => m.r === r).forEach(match => {
                            match.sA = "0";
                            match.sB = "0";
                            match.Wn = "";
                            if (match.r === 'F') match.rU = "";
                            resetCount++;
                        });
                    }
                });

                // Reset c√°c ƒë·ªôi v√≤ng lo·∫°i v·ªÅ placeholder ban ƒë·∫ßu n·∫øu v√≤ng b·∫£ng b·ªã reset
                if (roundsToReset.some(r => r.startsWith('G')) || roundCode === 'ALL') {
                     tournamentState.matches.filter(m => m.r === 'QF').forEach(match => {
                        const groupLetterA = match.Mc.charAt(2) === '1' || match.Mc.charAt(2) === '2' ? 'A' : 'C'; // QF1, QF2: A vs B/ C vs D
                        const groupLetterB = match.Mc.charAt(2) === '1' || match.Mc.charAt(2) === '2' ? 'B' : 'D'; 

                        if (match.Mc === 'QF1') { match.A = 'W.A'; match.B = 'R.B'; }
                        if (match.Mc === 'QF2') { match.A = 'W.B'; match.B = 'R.A'; }
                        if (match.Mc === 'QF3') { match.A = 'W.C'; match.B = 'R.D'; }
                        if (match.Mc === 'QF4') { match.A = 'W.D'; match.B = 'R.C'; }
                    });
                }
                
                // T√≠nh to√°n l·∫°i BXH v√≤ng b·∫£ng (n·∫øu c·∫ßn)
                if (roundsToReset.some(r => r.startsWith('G'))) {
                    recalculateGroupStandings();
                }

                // C·∫≠p nh·∫≠t l·∫°i ng∆∞·ªùi tham gia v√≤ng lo·∫°i
                updateKnockoutParticipants();
                
                renderApp();
                showModal("Ho√†n t·∫•t Reset", `ƒê√£ x√≥a k·∫øt qu·∫£ v√† reset ${resetCount} tr·∫≠n ƒë·∫•u trong v√≤ng ${roundCode}.`, false);
            }
        );
    };

    // X·ª≠ l√Ω Xu·∫•t D·ªØ li·ªáu CSV
    window.exportData = (dataType) => {
        let data, filename, headers;
        
        if (dataType === 'tL') {
            data = tournamentState.tL.map(team => {
                const players = team.P.map(p => `${p.name} (${p.bY})`).join(' | ');
                return { 
                    'Group': team.g, 
                    'Team ID': team.T, 
                    'Nickname': team.Tn, 
                    'Avg Pick Level': team.aPL, 
                    'Players': players 
                };
            });
            filename = 'team_list_players.csv';
        } else if (dataType === 'matches') {
            data = tournamentState.matches;
            filename = 'all_matches_results.csv';
        } else if (dataType === 'teamStandings') {
            // L·∫•y c√°c tr∆∞·ªùng ƒë√£ t√≠nh to√°n
            data = tournamentState.teamStandings.map(s => ({
                'Group': s.g,
                'Rank': s.GRank,
                'Nickname': s.Tn,
                'Wins': s.W,
                'Losses': s.L,
                'Points': s.Pts,
                'Played': s.mP,
                'PF': s.PF,
                'PA': s.PA,
                'PD': s.PD,
            }));
            filename = 'group_standings.csv';
        } else {
            return;
        }

        const csv = convertToCSV(data);
        downloadCSV(csv, filename);
    };

    // X·ª≠ l√Ω GitHub Save (Gi·∫£ l·∫≠p)
    window.saveToGithub = () => {
        const messageElement = document.getElementById('github-message');
        const outputJsonElement = document.getElementById('output-json');
        
        // T·∫°o JSON ƒë·∫ßu ra (to√†n b·ªô state)
        const finalJson = JSON.stringify(tournamentState, null, 2);
        outputJsonElement.value = finalJson;
        
        // Do kh√¥ng th·ªÉ g·ªçi API GitHub tr·ª±c ti·∫øp t·ª´ frontend m√† kh√¥ng c√≥ CORS/Server/Token, ch√∫ng ta ch·ªâ m√¥ ph·ªèng
        const token = document.getElementById('github-token').value.trim();

        if (!token) {
            messageElement.textContent = "‚ö† Vui l√≤ng d√°n JSON n√†y v√†o file data/statex.json tr√™n GitHub. Ch·ª©c nƒÉng l∆∞u t·ª± ƒë·ªông c·∫ßn Token v√† Backend.";
            messageElement.classList.remove('text-green-600', 'text-red-600');
            messageElement.classList.add('text-yellow-600', 'font-bold');
            outputJsonElement.focus();
            outputJsonElement.select();
            showModal("M√¥ ph·ªèng L∆∞u", "Do gi·ªõi h·∫°n b·∫£o m·∫≠t, b·∫°n c·∫ßn t·ª± d√°n n·ªôi dung JSON ƒë√£ xu·∫•t ra v√†o file tr√™n GitHub.", false);
            return;
        }

        // N·∫øu c√≥ token (ch·ªâ l√† m√¥ ph·ªèng th√†nh c√¥ng cho ng∆∞·ªùi d√πng th·∫•y)
        messageElement.textContent = "‚úÖ M√¥ ph·ªèng th√†nh c√¥ng! JSON ƒë√£ ƒë∆∞·ª£c t·∫°o. N·∫øu c√≥ Backend th·ª±c t·∫ø, n√≥ s·∫Ω ƒë∆∞·ª£c ƒë·∫©y l√™n GitHub.";
        messageElement.classList.remove('text-yellow-600', 'text-red-600');
        messageElement.classList.add('text-green-600', 'font-bold');
        outputJsonElement.focus();
        outputJsonElement.select();

    };


    // --- INITIALIZATION ---

    document.addEventListener('DOMContentLoaded', () => {
        // 1. Kh·ªüi t·∫°o d·ªØ li·ªáu v√† t√≠nh to√°n ban ƒë·∫ßu
        initializeState();

        // 2. Render UI l·∫ßn ƒë·∫ßu
        renderApp();
        
        // 3. Thi·∫øt l·∫≠p Event Listener cho Tabs
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (e) => {
                changeTab(e.target.getAttribute('data-tab'));
            });
        });
        
        // ƒê·∫∑t tab m·∫∑c ƒë·ªãnh l√† Info
        changeTab('info');
    });

    </script>
</body>
</html>
