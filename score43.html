<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Giải Đấu & Cập Nhật Thông Tin (GitHub Sync) V6.5 - DEV</title> 
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Base styles for Dark Mode */
        :root {
            --bg-color: #111827; 
            --text-color: #f3f4f6; 
            --card-bg: #1f2937; 
            --border-color: #374151; 
            --accent-color: #06b6d4; 
            --match-bg: #1f2937;
            --input-bg: #4b5563; 
            --group-header-text: #60a5fa; 
        }
        
        /* Light Mode Overrides */
        .light-mode {
            --bg-color: #f9fafb; 
            --text-color: #111827; 
            --card-bg: #ffffff;
            --border-color: #e5e7eb; 
            --accent-color: #ef4444; 
            --match-bg: #f3f4f6; 
            --input-bg: #ffffff;
            --group-header-text: #10b981; 
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 1200px;
        }
        .score-input, .text-input {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }
        .score-input:focus, .text-input:focus {
            box-shadow: 0 0 0 3px var(--accent-color);
        }
        .tab-button {
            border-bottom-color: var(--border-color);
        }
        .tab-button.active {
            color: var(--accent-color);
            border-color: var(--accent-color);
            background-color: var(--card-bg);
        }
        .tab-content {
            display: none;
            background-color: var(--card-bg);
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
        }
        
        ::-webkit-scrollbar { height: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        .match-card {
            background-color: var(--match-bg);
            border-bottom: 1px solid var(--border-color);
        }
        .light-mode .match-card {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="container mx-auto">
        <header class="flex items-center justify-between mb-6">
            <div class="flex items-center">
                <svg class="w-10 h-10 md:w-12 md:h-12 text-[var(--accent-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15.75l-4-4m0 0l4-4m-4 4h14M17 12a5 5 0 11-10 0 5 5 0 0110 0z"></path></svg>
                <div class="text-left ml-4">
                    <h1 class="text-xl md:text-3xl font-extrabold text-[var(--text-color)] leading-none">QUẢN LÝ GIẢI ĐẤU PICKLEBALL (V6.5)</h1>
                    <p class="text-xs md:text-sm text-[var(--accent-color)]">Cập Nhật Tỉ Số & Thông Tin Đội (GitHub Sync) - FIXED</p>
                </div>
            </div>
            
            <button id="themeToggle" onclick="toggleTheme()" class="p-3 rounded-full bg-[var(--card-bg)] shadow-md text-[var(--text-color)] hover:bg-[var(--border-color)] transition duration-200">
                <svg id="sunIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="moonIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </header>

        <div id="statusMessage" class="text-center p-4 bg-blue-900/50 rounded-lg text-blue-300 font-semibold mb-6">
            Đang tải dữ liệu trạng thái từ GitHub...
        </div>
        
        <nav class="mb-8 border-b border-[var(--border-color)] overflow-x-auto whitespace-nowrap">
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('General')" data-tab="General">General</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('TeamManagement')" data-tab="TeamManagement">Quản Lý Đội</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('GroupA')" data-tab="GroupA">Group A</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('GroupB')" data-tab="GroupB">Group B</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('GroupC')" data-tab="GroupC">Group C</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('GroupD')" data-tab="GroupD">Group D</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('Knockout')" data-tab="Knockout">Knockout</button>
            <button class="tab-button py-3 px-4 md:px-6 text-sm md:text-base font-semibold border-b-2 border-transparent text-gray-400 hover:text-[var(--accent-color)] transition" onclick="switchTab('Configuration')" data-tab="Configuration">Cấu Hình</button>
        </nav>

        <div id="General" class="tab-content">
             <h2 class="text-3xl font-extrabold text-yellow-500 mb-6 border-b border-[var(--border-color)] pb-2">Final Results (Kết quả chung cuộc)</h2>
            <section id="finalResults" class="mb-10 p-4 rounded-xl shadow-lg bg-[var(--match-bg)]">
                <div id="championDisplay" class="text-center">
                    <p class="text-4xl font-black text-yellow-500 mb-2">Chưa xác định</p>
                    <p class="text-lg text-yellow-500">Nhà Vô Địch Giải Đấu</p>
                </div>
                 <div id="runnerUpDisplay" class="text-center mt-4 border-t border-[var(--border-color)] pt-4">
                    <p class="text-2xl font-bold text-gray-400 mb-1">Chưa xác định</p>
                    <p class="text-md text-gray-400">Á Quân Giải Đấu</p>
                </div>
            </section>

            <h2 class="text-3xl font-extrabold text-[var(--text-color)] mb-6 border-b border-[var(--border-color)] pb-2">Team List (Danh sách các đội)</h2>
            <section id="teamList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </section>
        </div>
        
        <div id="TeamManagement" class="tab-content">
            <h2 class="text-3xl font-extrabold text-blue-500 mb-6 border-b border-[var(--border-color)] pb-2">Quản Lý Thông Tin Đội (Lưu cục bộ)</h2>
            <p class="text-sm text-gray-400 mb-4">Điều chỉnh **Tên đội (Tn)**, **Tên người chơi (name)**, **Cấp độ (pL)**, và **Năm sinh (bY)**. Các thay đổi này chỉ được lưu cục bộ và **chỉ được đồng bộ lên GitHub khi bạn COMMIT TỈ SỐ** (sử dụng file `state41s.json`).</p>
            
            <button id="saveTeamLocalButton" onclick="saveTeamChangesToLocal()" class="w-full md:w-auto px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-lg transition duration-300 mb-6">
                LƯU CÁC THAY ĐỔI ĐỘI CỤC BỘ (Không Commit)
            </button>
            
            <div id="teamCommitResult" class="mt-3 p-3 rounded-lg text-sm font-semibold hidden"></div>

            <section id="teamManagementList" class="space-y-6"></section>
        </div>


        <div id="GroupA" class="tab-content space-y-6">
            <button onclick="simulateScores('A')" class="w-full md:w-auto px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                GIẢ LẬP TỈ SỐ VÒNG BẢNG A
            </button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="tableA" class="lg:col-span-1"></div>
                <div id="matchesA" class="lg:col-span-2"></div>
            </div>
        </div>

        <div id="GroupB" class="tab-content space-y-6">
            <button onclick="simulateScores('B')" class="w-full md:w-auto px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                GIẢ LẬP TỈ SỐ VÒNG BẢNG B
            </button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="tableB" class="lg:col-span-1"></div>
                <div id="matchesB" class="lg:col-span-2"></div>
            </div>
        </div>

        <div id="GroupC" class="tab-content space-y-6">
             <button onclick="simulateScores('C')" class="w-full md:w-auto px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                GIẢ LẬP TỈ SỐ VÒNG BẢNG C
            </button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="tableC" class="lg:col-span-1"></div>
                <div id="matchesC" class="lg:col-span-2"></div>
            </div>
        </div>

        <div id="GroupD" class="tab-content space-y-6">
             <button onclick="simulateScores('D')" class="w-full md:w-auto px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                GIẢ LẬP TỈ SỐ VÒNG BẢNG D
            </button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div id="tableD" class="lg:col-span-1"></div>
                <div id="matchesD" class="lg:col-span-2"></div>
            </div>
        </div>

        <div id="Knockout" class="tab-content">
            <h2 class="text-3xl font-extrabold text-[var(--group-header-text)] mb-6 border-b border-[var(--border-color)] pb-2">Vòng Loại Trực Tiếp (Knockout Stage)</h2>
            <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4 mb-6">
                <button onclick="seedKnockoutMatches()" id="seedButton" class="w-full md:w-auto px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50">
                    TỰ ĐỘNG XẾP CẶP TỨ KẾT (SEEDING)
                </button>
                <button onclick="simulateScores('Knockout')" class="w-full md:w-auto px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                    GIẢ LẬP TỈ SỐ VÒNG LOẠI (QF, SF, F)
                </button>
            </div>
            
            <div id="seedingStatus" class="p-3 bg-blue-900/30 text-blue-300 rounded-lg mb-6">
                Trạng thái Seeding: Chưa khởi tạo Tứ kết.
            </div>
            
            <div id="quarterfinals" class="mb-6"></div>
            <div id="semifinals" class="mb-6"></div>
            <div id="finalMatchSection">
                <div id="finalSection"></div>
            </div>
        </div>

        <div id="Configuration" class="tab-content space-y-8">
            <h2 class="text-3xl font-extrabold text-red-500 mb-6 border-b border-[var(--border-color)] pb-2">Cấu Hình & Đồng Bộ Hóa (GitHub API)</h2>
            
             <section class="p-4 bg-red-900/20 rounded-lg border-l-4 border-red-500">
                <h3 class="text-xl font-bold text-red-400 mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    1. GitHub Personal Access Token (PAT)
                </h3>
                <p class="text-sm text-red-300 mb-4 font-bold">CẢNH BÁO BẢO MẬT: Token này sẽ được lưu trữ trong trình duyệt. Chỉ sử dụng Token có phạm vi (Scope) nhỏ nhất. <span class="text-yellow-300">CẦN PHẢI CÓ QUYỀN **repo** (hoặc contents:write)</span>.</p>
                <input type="password" id="githubToken" 
                    class="score-input w-full p-2 rounded-md focus:ring-red-500 transition" 
                    placeholder="Dán GitHub PAT của bạn vào đây...">
                <button onclick="saveToken()" class="mt-2 px-4 py-1 bg-green-600 hover:bg-green-700 text-white text-sm font-bold rounded-lg transition duration-300">Lưu Token cục bộ</button>
            </section>

            <section class="p-4 bg-[var(--match-bg)] rounded-lg border-l-4 border-purple-500">
                <h3 class="text-xl font-bold text-[var(--group-header-text)] mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    2. Cập Nhật Tỉ Số (Commit) lên **state41s.json**
                </h3>
                <p class="text-gray-400 mb-4">Sử dụng Token đã lưu để commit những tỉ số và thông tin đội **đã thay đổi** lên GitHub (file `state41s.json`).</p>
                
                <button id="commitScoreButton" onclick="commitScoreChangesToGitHub()" class="w-full md:w-auto px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition duration-300 mb-4 disabled:opacity-50">
                    COMMIT TỈ SỐ & THAY ĐỔI ĐỘI
                </button>

                <div id="scoreCommitResult" class="mt-3 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </section>
            
             <section class="p-4 bg-[var(--match-bg)] rounded-lg border-l-4 border-green-500">
                 <h3 class="text-xl font-bold text-[var(--group-header-text)] mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    3. Xuất Dữ Liệu Giải Đấu (state41.json Format)
                </h3>
                <p class="text-[var(--text-color)] mb-4">Tạo và tải về file JSON chứa toàn bộ trạng thái giải đấu hiện tại, bao gồm thông tin đội và tỉ số đã tính toán.</p>
                <button onclick="exportTournamentData()" class="md:w-auto px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                    TẢI XUỐNG TOÀN BỘ JSON
                </button>
                <div id="configExportResult" class="mt-3 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </section>
            
            <section class="p-4 bg-[var(--match-bg)] rounded-lg border-l-4 border-red-500">
                <h3 class="text-xl font-bold text-red-400 mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    4. Xóa (Reset) Tỉ Số Trận Đấu
                </h3>
                <p class="text-gray-400 mb-4">Chọn vòng đấu và nhấn nút để **XÓA TẤT CẢ** tỉ số đã nhập trong vòng đó về trạng thái trống (null).</p>
                
                <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4">
                    <select id="resetRoundSelector" class="text-input w-full md:w-1/2 p-2 rounded-md">
                        <option value="">-- Chọn Vòng Đấu --</option>
                        <option value="A">Vòng Bảng A</option>
                        <option value="B">Vòng Bảng B</option>
                        <option value="C">Vòng Bảng C</option>
                        <option value="D">Vòng Bảng D</option>
                        <option value="QF">Tứ Kết (QF)</option>
                        <option value="SF">Bán Kết (SF)</option>
                        <option value="F">Chung Kết (F)</option>
                    </select>
                    
                    <button onclick="confirmResetScores()" class="w-full md:w-auto px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition duration-300 disabled:opacity-50">
                        XÓA TỈ SỐ ĐÃ CHỌN
                    </button>
                </div>
                <div id="resetResult" class="mt-3 p-3 rounded-lg text-sm font-semibold hidden"></div>
            </section>
            
            <section class="p-4 bg-[var(--match-bg)] rounded-lg border-l-4 border-yellow-500">
                 <h3 class="text-xl font-bold text-[var(--group-header-text)] mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    5. Tùy Chọn Giao Diện & Đồng Bộ Lại
                </h3>
                <p class="text-[var(--text-color)] mb-4">Bạn có thể chuyển đổi giữa giao diện Sáng/Tối hoặc tải lại trạng thái online mới nhất.</p>
                <button onclick="document.getElementById('themeToggle').click()" class="md:w-auto px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-black font-bold rounded-lg shadow-lg transition duration-300 mr-4">
                    Chuyển Đổi Giao Diện (Hiện tại: <span id="currentThemeDisplay">Tối</span>)
                </button>
                <button id="reSyncButton" onclick="showConfirmationModal()" class="md:w-auto px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
                    Đồng Bộ Lại (Tải lại từ GitHub)
                </button>
            </section>

        </div>

    </div>
    
    <div id="confirmationBox" class="modal-backdrop hidden">
        <div class="bg-[var(--card-bg)] p-6 rounded-xl shadow-2xl w-11/12 max-w-sm border-t-4 border-red-500 text-[var(--text-color)]">
            <h4 class="text-xl font-bold text-red-400 mb-4">Xác Nhận Đồng Bộ Lại</h4>
            <p class="text-[var(--text-color)] mb-6">Bạn có chắc chắn muốn **ĐỒNG BỘ LẠI** trạng thái giải đấu về dữ liệu mới nhất từ GitHub không? Điều này sẽ ghi đè trạng thái đang nhập cục bộ!</p>
            <div class="flex justify-end space-x-4">
                <button id="confirmNo" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition duration-150">Hủy bỏ</button>
                <button id="confirmYes" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition duration-150">Xác nhận Đồng bộ</button>
            </div>
        </div>
    </div>

    <script>
        
        // ==============================================================================================================
        // KHỐI CẤU HÌNH GITHUB API & DỮ LIỆU (Phiên bản V6.5 - FIX initializeApp)
        // ==============================================================================================================
        const GITHUB_REPO_OWNER = 'cqtin2024';
        const GITHUB_REPO_NAME = 'ITVTG';
        
        const SCORE_FILE_PATH = 'data/state41s.json'; 
        const SCORE_API_URL = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${SCORE_FILE_PATH}`;
        const DIFF_DATA_URL = `https://raw.githubusercontent.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/main/${SCORE_FILE_PATH}`;

        const BASE_FILE_PATH = 'data/state41.json'; 
        const BASE_API_URL = `https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/contents/${BASE_FILE_PATH}`;
        const STATIC_DATA_URL = `https://raw.githubusercontent.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/main/${BASE_FILE_PATH}`;

        const BRANCH = 'main';
        const HIGH_SCORE_LIMIT = 11; 

        let tournamentData = null; 
        let initialTournamentData = null; 
        let githubToken = ''; 
        let startX = 0; 
        let endX = 0;  
        const swipeThreshold = 75; 
        
        const jsonToBase64 = (json) => btoa(unescape(encodeURIComponent(JSON.stringify(json, null, 2))));
        
        // ==============================================================================================================
        // --- HÀM HỖ TRỢ DỮ LIỆU ---
        // ==============================================================================================================

        function showStatus(message, type = 'info', elementId = 'statusMessage') { /* ... (Giữ nguyên) ... */ }
        function switchTab(tabId) { /* ... (Giữ nguyên) ... */ }
        function applyTheme(theme) { /* ... (Giữ nguyên) ... */ }
        function toggleTheme() { /* ... (Giữ nguyên) ... */ }
        function getTeamInfo(teamID) { /* ... (Giữ nguyên) ... */ }
        function getGroupRankedTeam(groupCode, rank) { /* ... (Giữ nguyên) ... */ }
        function findMatchByCode(matchCode) { /* ... (Giữ nguyên) ... */ }
        function showConfirmationModal() { /* ... (Giữ nguyên) ... */ }
        function handleGesture() { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: HÀM API GITHUB (Đã lược bỏ để ngắn gọn, nội dung giữ nguyên V6.4)
        // ==============================================================================================================
        
        async function fetchGitHubFile(url, isBaseFile = false) { /* ... (Giữ nguyên) ... */ }
        async function loadDataFromGitHub() { /* ... (Giữ nguyên) ... */ }
        function saveToken() { /* ... (Giữ nguyên) ... */ }
        async function commitChangesToGitHub(filePath, content, commitMessage, isDelete = false) { /* ... (Giữ nguyên) ... */ }
        function getMatchDiffData() { /* ... (Giữ nguyên) ... */ }
        function getDiffData() { /* ... (Giữ nguyên) ... */ }
        async function commitScoreChangesToGitHub() { /* ... (Giữ nguyên) ... */ }
        window.reSyncStaticData = function() { /* ... (Giữ nguyên) ... */ }
        function exportTournamentData() { /* ... (Giữ nguyên) ... */ }
        function resetScores(round) { /* ... (Giữ nguyên) ... */ }
        function confirmResetScores() { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: LOGIC TÍNH TOÁN & RÀNG BUỘC ĐIỂM SỐ (Giữ nguyên V6.4)
        // ==============================================================================================================
        
        window.handleInputScore = function(inputElement, matchCode, teamSide) { /* ... (Giữ nguyên) ... */ }
        function calculateWinnerLoser(match) { /* ... (Giữ nguyên) ... */ }
        function calculateGroupStatsAndRanks() { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: LOGIC TEAM MANAGEMENT & DIFF (Giữ nguyên V6.4)
        // ==============================================================================================================

        window.saveTeamChangesToLocal = function() { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: LOGIC KNOCKOUT SEEDING & UI RENDERING (Giữ nguyên V6.4)
        // ==============================================================================================================
        
        window.seedKnockoutMatches = function() { /* ... (Giữ nguyên) ... */ }
        function updateSemiFinalSeeding() { /* ... (Giữ nguyên) ... */ }
        function renderFinalResults() { /* ... (Giữ nguyên) ... */ }
        function renderTeamManagement() { /* ... (Giữ nguyên) ... */ }
        function renderKnockoutMatches(roundCode) { /* ... (Giữ nguyên) ... */ }
        function simulateScores(round) { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: RENDERING CORE (Giữ nguyên V6.4)
        // ==============================================================================================================

        function renderTeamList() { /* ... (Giữ nguyên) ... */ }
        function renderGroupTables(groupCode) { /* ... (Giữ nguyên) ... */ }
        function renderGroupMatches(groupCode) { /* ... (Giữ nguyên) ... */ }
        function renderAllData() { /* ... (Giữ nguyên) ... */ }
        
        // ==============================================================================================================
        // 🚩 V6.5: KHỞI TẠO ỨNG DỤNG (FIXED - ĐƯA HÀM RA GLOBAL SCOPE)
        // ==============================================================================================================
        
        // Gắn hàm initializeApp vào đối tượng window để nó có thể được truy cập từ window.onload
        window.initializeApp = function() {
            // Load token và theme đã lưu
            githubToken = localStorage.getItem('githubToken') || '';
            const savedTheme = localStorage.getItem('theme') || 'dark'; 
            applyTheme(savedTheme);

            if (githubToken) {
                 document.getElementById('githubToken').value = '********';
            }

            // Event listeners for theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Event listeners for swipe navigation (on the whole app container)
            document.getElementById('app').addEventListener('touchstart', (e) => {
                // Ignore if touching an input field
                if (e.target.closest('.score-input, .text-input')) return;
                startX = e.changedTouches[0].screenX;
            }, { passive: true });

            document.getElementById('app').addEventListener('touchend', (e) => {
                // Ignore if touching an input field
                if (e.target.closest('.score-input, .text-input')) return;
                endX = e.changedTouches[0].screenX;
                handleGesture();
            }, { passive: true });
            
            // Modal button setup
            document.getElementById('confirmYes').onclick = window.reSyncStaticData;
            document.getElementById('confirmNo').onclick = () => document.getElementById('confirmationBox').classList.add('hidden');

            loadDataFromGitHub();
        }

        window.onload = window.initializeApp; // Gọi hàm qua window object
    </script>
</body>
</html>
