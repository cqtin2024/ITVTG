<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫≠p Nh·∫≠t T·ªâ S·ªë Gi·∫£i ƒê·∫•u C·∫ßu L√¥ng ƒê√¥i</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        h1, h2 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .matches-section, .tables-section, .knockout-section {
            flex: 1;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .group-table, .group-matches {
            margin-bottom: 30px;
            border: 1px solid #ccc;
            border-radius: 6px;
            overflow: hidden;
        }
        .group-matches h3, .group-table h3 {
            background-color: #007bff;
            color: white;
            padding: 10px;
            margin: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #e9ecef;
        }
        .score-input {
            width: 40px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .highlight-winner {
            background-color: #d4edda;
            font-weight: bold;
        }
        .highlight-runnerup {
            background-color: #fff3cd;
        }
        .knockout-list {
            list-style: none;
            padding: 0;
        }
        .knockout-list li {
            padding: 8px;
            margin-bottom: 5px;
            background-color: #e9f5ff;
            border-left: 5px solid #007bff;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>üèÜ Gi·∫£i ƒê·∫•u C·∫ßu L√¥ng ƒê√¥i - B·∫£ng ƒêi·ªÅu Khi·ªÉn T·ªâ S·ªë</h1>
    <p>C·∫≠p nh·∫≠t t·ªâ s·ªë c√°c tr·∫≠n ƒë·∫•u v√≤ng b·∫£ng (m·ªói tr·∫≠n th·∫Øng ƒë∆∞·ª£c 3 ƒëi·ªÉm).</p>

    <div class="container">
        <div class="matches-section">
            <h2>Tr·∫≠n ƒê·∫•u V√≤ng B·∫£ng</h2>
            <div id="matches-container">
                </div>
        </div>

        <div class="tables-section">
            <h2>B·∫£ng X·∫øp H·∫°ng</h2>
            <div id="tables-container">
                </div>
        </div>
    </div>

    <div class="knockout-section">
        <h2>‚úÖ C√°c ƒê·ªôi V√†o T·ª© K·∫øt (Nh·∫•t & Nh√¨ B·∫£ng)</h2>
        <ul id="knockout-teams" class="knockout-list">
            </ul>
    </div>
    
    <script>
        // D·ªØ li·ªáu JSON ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t tr∆∞·ªõc ƒë√≥
        const originalData = {
            "key_legend": { /* ... (ƒë√£ r√∫t g·ªçn cho code) ... */ },
            "tableA": [ { "D": "Team 9", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3 }, { "D": "Team 3", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3 }, { "D": "Team 11", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3 }, { "D": "Team 5", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3 } ],
            "tableB": [ { "D": "Team 4", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3 }, { "D": "Team 7", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3 }, { "D": "Team 12", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3 }, { "D": "Team 1", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3 } ],
            "tableC": [ { "D": "Team 16", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3 }, { "D": "Team 10", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3 }, { "D": "Team 14", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3 }, { "D": "Team 6", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3 } ],
            "tableD": [ { "D": "Team 13", "W": 3, "L": 0, "HS": "11", "Pts": 9, "mP": 3 }, { "D": "Team 8", "W": 2, "L": 1, "HS": "11", "Pts": 6, "mP": 3 }, { "D": "Team 15", "W": 1, "L": 2, "HS": "11", "Pts": 3, "mP": 3 }, { "D": "Team 2", "W": 0, "L": 3, "HS": "0", "Pts": 0, "mP": 3 } ],
            "matchesA": [ { "t": "14:00", "c": "S1", "A": "Team 9", "sA": "11", "B": "Team 3", "sB": "0", "Wn": "Team 9" }, { "t": "14:15", "c": "S1", "A": "Team 11", "sA": "11", "B": "Team 5", "sB": "0", "Wn": "Team 11" }, { "t": "14:30", "c": "S1", "A": "Team 9", "sA": "11", "B": "Team 11", "sB": "0", "Wn": "Team 9" }, { "t": "14:45", "c": "S1", "A": "Team 3", "sA": "11", "B": "Team 5", "sB": "0", "Wn": "Team 3" }, { "t": "15:00", "c": "S1", "A": "Team 9", "sA": "11", "B": "Team 5", "sB": "0", "Wn": "Team 9" }, { "t": "15:15", "c": "S1", "A": "Team 3", "sA": "11", "B": "Team 11", "sB": "0", "Wn": "Team 3" } ],
            "matchesB": [ { "t": "14:00", "c": "S2", "A": "Team 4", "sA": "11", "B": "Team 7", "sB": "0", "Wn": "Team 4" }, { "t": "14:15", "c": "S2", "A": "Team 12", "sA": "11", "B": "Team 1", "sB": "0", "Wn": "Team 12" }, { "t": "14:30", "c": "S2", "A": "Team 4", "sA": "11", "B": "Team 12", "sB": "0", "Wn": "Team 4" }, { "t": "14:45", "c": "S2", "A": "Team 7", "sA": "11", "B": "Team 1", "sB": "0", "Wn": "Team 7" }, { "t": "15:00", "c": "S2", "A": "Team 4", "sA": "11", "B": "Team 1", "sB": "0", "Wn": "Team 4" }, { "t": "15:15", "c": "S2", "A": "Team 7", "sA": "11", "B": "Team 12", "sB": "0", "Wn": "Team 7" } ],
            "matchesC": [ { "t": "14:00", "c": "S3", "A": "Team 16", "sA": "11", "B": "Team 10", "sB": "0", "Wn": "Team 16" }, { "t": "14:15", "c": "S3", "A": "Team 14", "sA": "11", "B": "Team 6", "sB": "0", "Wn": "Team 14" }, { "t": "14:30", "c": "S3", "A": "Team 16", "sA": "11", "B": "Team 14", "sB": "0", "Wn": "Team 16" }, { "t": "14:45", "c": "S3", "A": "Team 10", "sA": "11", "B": "Team 6", "sB": "0", "Wn": "Team 10" }, { "t": "15:00", "c": "S3", "A": "Team 16", "sA": "11", "B": "Team 6", "sB": "0", "Wn": "Team 16" }, { "t": "15:15", "c": "S3", "A": "Team 10", "sA": "11", "B": "Team 14", "sB": "0", "Wn": "Team 10" } ],
            "matchesD": [ { "t": "14:00", "c": "S4", "A": "Team 13", "sA": "11", "B": "Team 8", "sB": "0", "Wn": "Team 13" }, { "t": "14:15", "c": "S4", "A": "Team 15", "sA": "11", "B": "Team 2", "sB": "0", "Wn": "Team 15" }, { "t": "14:30", "c": "S4", "A": "Team 13", "sA": "11", "B": "Team 15", "sB": "0", "Wn": "Team 13" }, { "t": "14:45", "c": "S4", "A": "Team 8", "sA": "11", "B": "Team 2", "sB": "0", "Wn": "Team 8" }, { "t": "15:00", "c": "S4", "A": "Team 13", "sA": "11", "B": "Team 2", "sB": "0", "Wn": "Team 13" }, { "t": "15:15", "c": "S4", "A": "Team 8", "sA": "11", "B": "Team 15", "sB": "0", "Wn": "Team 8" } ],
            "tL": [ /* ... (Danh s√°ch ƒë·ªôi ƒë√£ r√∫t g·ªçn cho code) ... */ ]
        };

        const groups = ['A', 'B', 'C', 'D'];
        const data = JSON.parse(JSON.stringify(originalData)); // T·∫°o b·∫£n sao ƒë·ªÉ tr√°nh thay ƒë·ªïi d·ªØ li·ªáu g·ªëc

        // H√†m t√≠nh to√°n l·∫°i b·∫£ng x·∫øp h·∫°ng
        function calculateGroupTables() {
            const tableData = {};
            const groupTeams = {};
            
            // 1. Kh·ªüi t·∫°o d·ªØ li·ªáu
            data.tL.forEach(team => {
                const group = team.g;
                if (!tableData[group]) {
                    tableData[group] = {};
                    groupTeams[group] = [];
                }
                tableData[group][team.T] = { W: 0, L: 0, Pts: 0, mP: 0, D: team.T, HS: 0, GS: 0, GC: 0 }; // GS: Games Scored, GC: Games Conceded
                groupTeams[group].push(team.T);
            });

            // 2. C·∫≠p nh·∫≠t k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u
            groups.forEach(group => {
                data['matches' + group].forEach(match => {
                    const scoreA = parseInt(match.sA);
                    const scoreB = parseInt(match.sB);
                    
                    if (scoreA !== 0 || scoreB !== 0) { // Ch·ªâ t√≠nh tr·∫≠n ƒë√£ di·ªÖn ra
                        tableData[group][match.A].mP += 1;
                        tableData[group][match.B].mP += 1;
                        tableData[group][match.A].GS += scoreA;
                        tableData[group][match.B].GS += scoreB;
                        tableData[group][match.A].GC += scoreB;
                        tableData[group][match.B].GC += scoreA;

                        if (scoreA > scoreB) {
                            tableData[group][match.A].W += 1;
                            tableData[group][match.A].Pts += 3; // 3 ƒëi·ªÉm cho tr·∫≠n th·∫Øng
                            tableData[group][match.B].L += 1;
                            if (scoreA > tableData[group][match.A].HS) tableData[group][match.A].HS = scoreA;
                        } else if (scoreB > scoreA) {
                            tableData[group][match.B].W += 1;
                            tableData[group][match.B].Pts += 3;
                            tableData[group][match.A].L += 1;
                            if (scoreB > tableData[group][match.B].HS) tableData[group][match.B].HS = scoreB;
                        } else {
                            // H√≤a (N·∫øu c√≥, 1 ƒëi·ªÉm cho m·ªói ƒë·ªôi)
                            tableData[group][match.A].Pts += 1;
                            tableData[group][match.B].Pts += 1;
                        }
                    }
                });
            });

            // 3. X·∫øp h·∫°ng (S·∫Øp x·∫øp)
            groups.forEach(group => {
                const sortedTable = Object.values(tableData[group]).sort((a, b) => {
                    // Ti√™u ch√≠ 1: ƒêi·ªÉm s·ªë (Pts)
                    if (b.Pts !== a.Pts) return b.Pts - a.Pts;
                    
                    // Ti√™u ch√≠ 2: Hi·ªáu s·ªë game (GS - GC)
                    const diffA = a.GS - a.GC;
                    const diffB = b.GS - b.GC;
                    if (diffB !== diffA) return diffB - diffA;

                    // Ti√™u ch√≠ 3: T·ªïng s·ªë game th·∫Øng (GS)
                    return b.GS - a.GS;
                });
                data['table' + group] = sortedTable.map(item => ({ ...item, HS: item.HS.toString() })); // C·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu
            });

            renderTables();
            renderKnockoutTeams();
        }

        // H√†m render B·∫£ng X·∫øp H·∫°ng
        function renderTables() {
            const container = document.getElementById('tables-container');
            container.innerHTML = '';

            groups.forEach(group => {
                const tableHtml = `
                    <div class="group-table">
                        <h3>B·∫£ng ${group}</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>ƒê·ªôi (D)</th>
                                    <th>Th·∫Øng (W)</th>
                                    <th>Thua (L)</th>
                                    <th>ƒê.T√≠ch l≈©y (Pts)</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data['table' + group].map((team, index) => {
                                    let rowClass = '';
                                    if (index === 0) rowClass = 'highlight-winner';
                                    else if (index === 1) rowClass = 'highlight-runnerup';

                                    return `
                                        <tr class="${rowClass}">
                                            <td>${index + 1}</td>
                                            <td>${team.D}</td>
                                            <td>${team.W}</td>
                                            <td>${team.L}</td>
                                            <td>${team.Pts}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                container.innerHTML += tableHtml;
            });
        }

        // H√†m render Danh s√°ch ƒê·ªôi v√†o T·ª© k·∫øt
        function renderKnockoutTeams() {
            const ul = document.getElementById('knockout-teams');
            ul.innerHTML = '';
            
            groups.forEach(group => {
                const winner = data['table' + group][0];
                const runnerUp = data['table' + group][1];

                if (winner) {
                    ul.innerHTML += `<li>Nh·∫•t B·∫£ng ${group} (W.${group}): <strong>${winner.D}</strong></li>`;
                }
                if (runnerUp) {
                    ul.innerHTML += `<li>Nh√¨ B·∫£ng ${group} (R.${group}): <strong>${runnerUp.D}</strong></li>`;
                }
            });
        }

        // H√†m render Tr·∫≠n ƒë·∫•u (v√† g·∫Øn s·ª± ki·ªán c·∫≠p nh·∫≠t)
        function renderMatches() {
            const container = document.getElementById('matches-container');
            container.innerHTML = '';

            groups.forEach(group => {
                const matchesHtml = `
                    <div class="group-matches">
                        <h3>B·∫£ng ${group}</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>T.Gian</th>
                                    <th>S√¢n</th>
                                    <th>ƒê·ªôi A</th>
                                    <th>T·ªâ s·ªë</th>
                                    <th>ƒê·ªôi B</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data['matches' + group].map((match, matchIndex) => {
                                    return `
                                        <tr>
                                            <td>${match.t}</td>
                                            <td>${match.c}</td>
                                            <td>${match.A}</td>
                                            <td>
                                                <input type="number" min="0" value="${match.sA}" class="score-input" data-group="${group}" data-match-index="${matchIndex}" data-team="A">
                                                -
                                                <input type="number" min="0" value="${match.sB}" class="score-input" data-group="${group}" data-match-index="${matchIndex}" data-team="B">
                                            </td>
                                            <td>${match.B}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                container.innerHTML += matchesHtml;
            });

            // G·∫Øn s·ª± ki·ªán l·∫Øng nghe cho c√°c √¥ input
            document.querySelectorAll('.score-input').forEach(input => {
                input.addEventListener('change', updateScoreAndRecalculate);
                input.addEventListener('input', updateScoreAndRecalculate);
            });
        }

        // H√†m c·∫≠p nh·∫≠t ƒëi·ªÉm v√† t√≠nh to√°n l·∫°i
        function updateScoreAndRecalculate(event) {
            const input = event.target;
            const group = input.dataset.group;
            const matchIndex = parseInt(input.dataset.matchIndex);
            const team = input.dataset.team;
            let score = parseInt(input.value);

            if (isNaN(score) || score < 0) {
                score = 0;
                input.value = 0; // ƒê·∫∑t l·∫°i gi√° tr·ªã h·ª£p l·ªá
            }

            // C·∫≠p nh·∫≠t d·ªØ li·ªáu JSON
            if (team === 'A') {
                data['matches' + group][matchIndex].sA = score.toString();
            } else {
                data['matches' + group][matchIndex].sB = score.toString();
            }

            // T√≠nh to√°n l·∫°i B·∫£ng x·∫øp h·∫°ng
            calculateGroupTables();
        }

        // Kh·ªüi ch·∫°y khi t·∫£i trang
        document.addEventListener('DOMContentLoaded', () => {
            renderMatches();
            calculateGroupTables(); // T√≠nh to√°n l·∫ßn ƒë·∫ßu v·ªõi d·ªØ li·ªáu ƒë√£ c√≥
        });

    </script>
</body>
</html>
