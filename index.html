<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-m.groupA}`]) html += renderTable(data[`table${m.groupA}`], `Group ${m.groupA}`);
        if (data[`matches${m.groupA}`]) html += renderMatchList(data[`matches${m.groupA}`], `Results Group ${m.groupA}`);
      });
      
      c.innerHTML = html;
    }
    
    function renderTable(table, title) {
      if (!table || table.length === 0) return '';
      const headersMap = {'D': 'Team', 'W': 'W', 'L': 'L', 'HS': 'PD', 'Pts': 'Pts'};
      const rawHeaders = Object.keys(table[0]).filter(h => h !== 'mP');
      const displayHeaders = rawHeaders.map(h => headersMap[h] || h);

      let html = `<div class='bg-white p-4 mt-4 rounded-xl shadow'><h3 class='text-lg font-semibold text-green-800 mb-2 text-center'>${title}</h3>`;
      html += `<div class='overflow-x-auto'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-green-700 text-white'><tr>` +
        displayHeaders.map(h => `<th class='px-3 py-2'>${h}</th>`).join('') + `</tr></thead><tbody class='bg-white divide-y divide-gray-100'>`;
      table.forEach((row, i) => {
        let rowClass = i === 0 ? 'bg-green-50 font-semibold' : i === 1 ? 'bg-green-50' : '';
        const teamName = row.D === 'Team' ? 'Team' : getCombinedName(row.D); 
        html += `<tr class='hover:bg-green-50 ${rowClass}'>` + rawHeaders.map(h => {
            if (h === 'D') return `<td class='px-3 py-2 text-left font-semibold'>${teamName}</td>`;
            return `<td class='px-3 py-2 text-center'>${row[h]}</td>`;
        }).join('') + `</tr>`;
      });
      html += `</tbody></table></div></div>`;
      return html;
    }

    function renderMatchList(matches, title) {
      if (!matches || matches.length === 0) return '';
      let html = `<div class='bg-white p-4 mt-4 rounded-xl shadow'><h3 class='text-lg font-semibold text-green-800 mb-2 text-center'>${title}</h3>`;
      html += `<div class='overflow-x-auto'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-green-700 text-white'><tr><th>Time</th><th>Court</th><th>Team A</th><th>Score</th><th>Team B</th></tr></thead><tbody>`;
      matches.forEach(m => {
        const teamA = getCombinedName(m.A); 
        const teamB = getCombinedName(m.B); 
        
        const aClass = m.Wn === m.A ? 'text-green-700 font-bold' : '';
        const bClass = m.Wn === m.B ? 'text-green-700 font-bold' : '';
        
        html += `<tr class='hover:bg-green-50'><td class='px-3 py-2 text-center'>${m.t || ''}</td><td class='px-3 py-2 text-center'>${m.c || ''}</td><td class='${aClass}'>${teamA}</td><td class='text-center'>${m.sA} - ${m.sB}</td><td class='${bClass}'>${teamB}</td></tr>`;
      });
      html += `</tbody></table></div></div>`;
      return html;
    }

    function renderQuarterfinals(quarters) {
      const c = document.getElementById('quarterfinals');
      if (!quarters || quarters.length === 0) {
        c.innerHTML = `<h2 class='text-2xl font-bold text-green-700 mb-3 text-center'>Quarterfinals</h2><div class='bg-white p-4 rounded-xl shadow text-gray-600 text-sm'>No quarterfinal data available.</div>`;
        return;
      }
      let html = `<h2 class='text-2xl font-bold text-green-700 mb-3 text-center'>Quarterfinals</h2>`;
      html += `<div class='bg-white p-4 rounded-xl shadow'><table class='min-w-full divide-y divide-gray-200 text-sm'><thead class='bg-green-700 text-white'><tr><th>Team A</th><th>Score</th><th>Team B</th><th>Winner</th></tr></thead><tbody>`;
      quarters.forEach(m => {
        const teamA = m.A;
        const teamB = m.B;
        const winner = m.Wn;

        html += `<tr class='hover:bg-green-50'><td class='px-3 py-2 text-center'>${teamA || ''}</td><td class='px-3 py-2 text-center'>${m.sA || ''} - ${m.sB || ''}</td><td class='px-3 py-2 text-center'>${teamB || ''}</td><td class='px-3 py-2 text-center text-green-700 font-semibold'>${winner || ''}</td></tr>`;
      });
      html += `</tbody></table></div>`;
      c.innerHTML = html;
    }

    function renderKnockout(semis, final) {
      const c = document.getElementById('knockout');
      let html = `<h2 class='text-2xl font-bold text-green-700 mb-3 text-center'>Final</h2>`;
      const noData = (!semis || semis.length === 0) && (!final || final.Wn === "TBD");

      if (semis && semis.length > 0) html += renderMatchList(semis, 'Semifinals');
      if (final && final.A) {
           const finalA = final.A;
           const finalB = final.B;
           const finalWinner = final.Wn;
           const runnerUp = final.rU;

           html += `<div class='winner-box bg-white p-4 mt-4 rounded-xl shadow text-center'><h3 class='text-lg font-semibold text-green-800 mb-2'>Final Match</h3><p><strong>${finalA || 'TBD'}</strong> (${final.sA || ''}) vs (${final.sB || ''}) <strong>${finalB || 'TBD'}</strong></p>`;
           if (final.Wn && final.Wn !== "TBD") {
               html += `<p class='mt-2 text-green-700 font-semibold'>üèÜ Champion: ${finalWinner}</p><p class='text-gray-700'>Runner-up: ${runnerUp || ''}</p></div>`;
           } else {
               html += `<p class='mt-2 text-gray-600'>Final match result is not available.</p></div>`;
           }
      }
      
      if (noData) {
        html += `<div class='bg-white p-4 rounded-xl shadow text-gray-600 text-sm'>No Semifinals or Final data available.</div>`;
      }
      c.innerHTML = html;
    }

    function renderPlayers(teamList) {
        const c = document.getElementById('players');
        let html = `<h2 class='text-2xl font-bold text-red-700 mb-3 text-center'>Team List</h2>`;
        
        if (!teamList || teamList.length === 0) {
            html += `<div class='bg-white p-4 rounded-xl shadow'><p class='text-sm text-gray-600'>Team list is not available (requires 'tL' key).</p></div>`;
            c.innerHTML = html;
            return;
        }
        
        const teamsByGroup = teamList.reduce((acc, team) => {
            (acc[team.g] = acc[team.g] || []).push(team);
            return acc;
        }, {});

        for (const group in teamsByGroup) {
            html += `<div class='bg-white p-4 rounded-xl shadow mt-4'>
                        <h3 class='text-lg font-bold text-green-700 mb-3 text-center'>GROUP ${group}</h3>
                        <div class='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3'>`;
            
            teamsByGroup[group].forEach(team => {
                const p1Name = team.P[0] || '';
                const p2Name = team.P[1] || '';
                const combinedName = `${getLastTwoWords(p1Name)} & ${getLastTwoWords(p2Name)}`; 

                html += `<div class='team-card border-l-4 border-green-500 p-3 rounded-lg bg-green-50'>
                            <div class='text-sm font-semibold text-red-700'>${combinedName}</div>
                            <div class='text-xs text-gray-500'>ID: ${team.T} | Group: ${team.g}</div>
                            <div class='text-xs mt-2 text-gray-700'>1. ${p1Name}</div>
                            <div class='text-xs text-gray-700'>2. ${p2Name}</div>
                         </div>`;
            });

            html += `</div></div>`;
        }
        c.innerHTML = html;
    }

    // Swipe handling
    let startX=0, isDown=false;
    document.addEventListener('touchstart', e=>{ startX = e.touches[0].clientX; isDown=true; });
    document.addEventListener('touchend', e=>{ 
        if(!isDown) return; 
        isDown=false; 
        const endX = e.changedTouches[0].clientX; 
        const diff = endX - startX; 
        if(diff > 60) goToSection(currentIndex-1); 
        if(diff < -60) goToSection(currentIndex+1); 
    });

    setInterval(fetchData, REFRESH_INTERVAL);
    fetchData();
  </script>
</body>
</html>
